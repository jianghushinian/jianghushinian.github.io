<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>åœ¨ Go ä¸­ï¼Œå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·æé«˜å¼€å‘æ•ˆç‡ï¼Ÿ | æ±Ÿæ¹–åå¹´ | å­¦è€Œä¸æ€åˆ™ç½”ï¼Œæ€è€Œä¸å­¦åˆ™æ®†ã€‚</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Go">
    <meta name="description" content="å¦‚æœä½ åšè¿‡ Java å¼€å‘ï¼Œé‚£ä¹ˆæƒ³å¿…ä¸€å®šå¬è¯´æˆ–ä½¿ç”¨è¿‡ä¾èµ–æ³¨å…¥ã€‚ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å°†ç»„ä»¶çš„ä¾èµ–é¡¹å¤–éƒ¨åŒ–ï¼Œä»è€Œä½¿ç»„ä»¶æœ¬èº«æ›´åŠ æ¨¡å—åŒ–å’Œå¯æµ‹è¯•ã€‚åœ¨ Java ä¸­ï¼Œä¾èµ–æ³¨å…¥å¹¿æ³›åº”ç”¨äºå„ç§æ¡†æ¶ä¸­ï¼Œå¸®åŠ©å¼€å‘è€…è§£è€¦ä»£ç å’Œæé«˜åº”ç”¨çš„çµæ´»æ€§ã€‚æœ¬æ–‡å°±æ¥ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Œä»¥åŠåœ¨ Go è¯­è¨€ä¸­å¦‚ä½•å®è·µä¾èµ–æ³¨å…¥ï¼Œæé«˜ Go é¡¹ç›®çš„å¼€å‘æ•ˆç‡å’Œå¯ç»´æŠ¤æ€§ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="åœ¨ Go ä¸­ï¼Œå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·æé«˜å¼€å‘æ•ˆç‡ï¼Ÿ">
<meta property="og:url" content="http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/index.html">
<meta property="og:site_name" content="æ±Ÿæ¹–åå¹´">
<meta property="og:description" content="å¦‚æœä½ åšè¿‡ Java å¼€å‘ï¼Œé‚£ä¹ˆæƒ³å¿…ä¸€å®šå¬è¯´æˆ–ä½¿ç”¨è¿‡ä¾èµ–æ³¨å…¥ã€‚ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å°†ç»„ä»¶çš„ä¾èµ–é¡¹å¤–éƒ¨åŒ–ï¼Œä»è€Œä½¿ç»„ä»¶æœ¬èº«æ›´åŠ æ¨¡å—åŒ–å’Œå¯æµ‹è¯•ã€‚åœ¨ Java ä¸­ï¼Œä¾èµ–æ³¨å…¥å¹¿æ³›åº”ç”¨äºå„ç§æ¡†æ¶ä¸­ï¼Œå¸®åŠ©å¼€å‘è€…è§£è€¦ä»£ç å’Œæé«˜åº”ç”¨çš„çµæ´»æ€§ã€‚æœ¬æ–‡å°±æ¥ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Œä»¥åŠåœ¨ Go è¯­è¨€ä¸­å¦‚ä½•å®è·µä¾èµ–æ³¨å…¥ï¼Œæé«˜ Go é¡¹ç›®çš„å¼€å‘æ•ˆç‡å’Œå¯ç»´æŠ¤æ€§ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-06-09T07:05:19.000Z">
<meta property="article:modified_time" content="2024-06-12T23:55:34.875Z">
<meta property="article:author" content="æ±Ÿæ¹–åå¹´">
<meta property="article:tag" content="Go">
<meta name="twitter:card" content="summary">
    
        <link rel="alternate" type="application/atom+xml" title="æ±Ÿæ¹–åå¹´" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">æ±Ÿæ¹–åå¹´</h5>
          <a href="mailto:jianghushinian007@outlook.com" title="jianghushinian007@outlook.com" class="mail">jianghushinian007@outlook.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                ä¸»é¡µ
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                å½’æ¡£
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ ‡ç­¾
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                åˆ†ç±»
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-link"></i>
                å…³äº
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/jianghushinian" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">åœ¨ Go ä¸­ï¼Œå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·æé«˜å¼€å‘æ•ˆç‡ï¼Ÿ</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="è¾“å…¥æ„Ÿå…´è¶£çš„å…³é”®å­—">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">åœ¨ Go ä¸­ï¼Œå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·æé«˜å¼€å‘æ•ˆç‡ï¼Ÿ</h1>
        <h5 class="subtitle">
            
                <time datetime="2024-06-09T07:05:19.000Z" itemprop="datePublished" class="page-time">
  2024-06-09
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Go/">Go</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ"><span class="post-toc-number">1.</span> <span class="post-toc-text">ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ä¾èµ–æ³¨å…¥å·¥å…·-Wire-ç®€ä»‹"><span class="post-toc-number">2.</span> <span class="post-toc-text">ä¾èµ–æ³¨å…¥å·¥å…· Wire ç®€ä»‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å®‰è£…-Wire"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">å®‰è£… Wire</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Wire-å¿«é€Ÿå¼€å§‹"><span class="post-toc-number">3.</span> <span class="post-toc-text">Wire å¿«é€Ÿå¼€å§‹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¾èµ–æ³¨å…¥å·¥å…·ï¼Ÿ"><span class="post-toc-number">4.</span> <span class="post-toc-text">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¾èµ–æ³¨å…¥å·¥å…·ï¼Ÿ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Wire-æ ¸å¿ƒæ¦‚å¿µ"><span class="post-toc-number">5.</span> <span class="post-toc-text">Wire æ ¸å¿ƒæ¦‚å¿µ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Wire-é«˜çº§ç”¨æ³•"><span class="post-toc-number">6.</span> <span class="post-toc-text">Wire é«˜çº§ç”¨æ³•</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#injector-å‡½æ•°å‚æ•°å’Œè¿”å›é”™è¯¯"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">injector å‡½æ•°å‚æ•°å’Œè¿”å›é”™è¯¯</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ä½¿ç”¨-ProviderSet-è¿›è¡Œåˆ†ç»„"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">ä½¿ç”¨ ProviderSet è¿›è¡Œåˆ†ç»„</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ä½¿ç”¨-Struct-å®šåˆ¶-Provider"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">ä½¿ç”¨ Struct å®šåˆ¶ Provider</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ä½¿ç”¨-Struct-å­—æ®µä½œä¸º-Provider"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">ä½¿ç”¨ Struct å­—æ®µä½œä¸º Provider</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ç»‘å®šã€Œå€¼ã€ä½œä¸º-Provider"><span class="post-toc-number">6.5.</span> <span class="post-toc-text">ç»‘å®šã€Œå€¼ã€ä½œä¸º Provider</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ç»‘å®šã€Œæ¥å£ã€ä½œä¸º-Provider"><span class="post-toc-number">6.6.</span> <span class="post-toc-text">ç»‘å®šã€Œæ¥å£ã€ä½œä¸º Provider</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ç»‘å®šç»“æ„ä½“åˆ°æ¥å£"><span class="post-toc-number">6.7.</span> <span class="post-toc-text">ç»‘å®šç»“æ„ä½“åˆ°æ¥å£</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ¸…ç†å‡½æ•°"><span class="post-toc-number">6.8.</span> <span class="post-toc-text">æ¸…ç†å‡½æ•°</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å¤‡ç”¨æ³¨å…¥å™¨è¯­æ³•ï¼Œç»™è¯­æ³•åŠ ç‚¹ç³–"><span class="post-toc-number">6.9.</span> <span class="post-toc-text">å¤‡ç”¨æ³¨å…¥å™¨è¯­æ³•ï¼Œç»™è¯­æ³•åŠ ç‚¹ç³–</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Wire-ç”Ÿäº§å®è·µ"><span class="post-toc-number">7.</span> <span class="post-toc-text">Wire ç”Ÿäº§å®è·µ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ä¸ºä»€ä¹ˆé€‰æ‹©-Wire"><span class="post-toc-number">8.</span> <span class="post-toc-text">ä¸ºä»€ä¹ˆé€‰æ‹© Wire</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Wire-å‘½ä»¤è¡Œå·¥å…·"><span class="post-toc-number">9.</span> <span class="post-toc-text">Wire å‘½ä»¤è¡Œå·¥å…·</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#æ€»ç»“"><span class="post-toc-number">10.</span> <span class="post-toc-text">æ€»ç»“</span></a></li></ol>
        </nav>
    </aside>


<article id="post-how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">åœ¨ Go ä¸­ï¼Œå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·æé«˜å¼€å‘æ•ˆç‡ï¼Ÿ</h1>
        <div class="post-meta">
            <time class="post-time" title="2024-06-09 15:05:19" datetime="2024-06-09T07:05:19.000Z"  itemprop="datePublished">2024-06-09</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Go/">Go</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="æ–‡ç« æ€»é˜…è¯»é‡" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>å¦‚æœä½ åšè¿‡ Java å¼€å‘ï¼Œé‚£ä¹ˆæƒ³å¿…ä¸€å®šå¬è¯´æˆ–ä½¿ç”¨è¿‡<strong>ä¾èµ–æ³¨å…¥</strong>ã€‚ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å°†ç»„ä»¶çš„ä¾èµ–é¡¹å¤–éƒ¨åŒ–ï¼Œä»è€Œä½¿ç»„ä»¶æœ¬èº«æ›´åŠ <strong>æ¨¡å—åŒ–å’Œå¯æµ‹è¯•</strong>ã€‚åœ¨ Java ä¸­ï¼Œä¾èµ–æ³¨å…¥å¹¿æ³›åº”ç”¨äºå„ç§æ¡†æ¶ä¸­ï¼Œå¸®åŠ©å¼€å‘è€…è§£è€¦ä»£ç å’Œæé«˜åº”ç”¨çš„çµæ´»æ€§ã€‚æœ¬æ–‡å°±æ¥ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Œä»¥åŠåœ¨ Go è¯­è¨€ä¸­å¦‚ä½•å®è·µä¾èµ–æ³¨å…¥ï¼Œæé«˜ Go é¡¹ç›®çš„å¼€å‘æ•ˆç‡å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<a id="more"></a>

<h3 id="ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ</h3><p>æ­£å¦‚å‰æ–‡æ‰€è¿°ï¼Œ<a href="https://zh.wikipedia.org/wiki/ä¾èµ–æ³¨å…¥" target="_blank" rel="noopener">ä¾èµ–æ³¨å…¥</a>ï¼ˆdependency injectionï¼Œç¼©å†™ä¸º DIï¼‰æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ã€‚</p>
<p>å®˜æ–¹å®šä¹‰æ¯”è¾ƒæ™¦æ¶©ï¼Œæˆ‘ç›´æ¥ä¸¾ä¸ªä¾‹å­ä½ å°±ç†è§£äº†ã€‚</p>
<p>åœ¨ Web å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>store</code> å±‚ï¼ˆæœ‰äº›åœ°æ–¹å¯ä¼šå°†å…¶å‘½åä¸º <code>repository</code>ã€<code>repo</code> ç­‰ï¼‰æ¥æ“ä½œæ•°æ®åº“è¿›è¡Œ CRUDã€‚Go è¯­è¨€ä¸­å¯ä»¥ä½¿ç”¨ GORM æ“ä½œæ•°æ®åº“ï¼Œæ‰€ä»¥ <code>store</code> ä¾èµ– <code>*gorm.DB</code>ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> userStore <span class="keyword">struct</span> &#123;</span><br><span class="line">	db *gorm.DB</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStore</span><span class="params">()</span> *<span class="title">userStore</span></span> &#123;</span><br><span class="line">	db := NewDB()</span><br><span class="line">	<span class="keyword">return</span> &amp;userStore&#123;db: db&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *userStore)</span> <span class="title">Create</span><span class="params">(ctx context.Context, user *model.UserM)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> u.db.Create(&amp;user).Error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>NOTE: å¦‚æœä½ å¯¹ GORM ä¸å¤ªäº†è§£ï¼Œå¯ä»¥é˜…è¯»æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« <a href="https://jianghushinian.cn/2023/05/27/go-popular-orm-framework-gorm-introduction/" target="_blank" rel="noopener">ã€ŠGo è¯­è¨€æµè¡Œ ORM æ¡†æ¶ GORM ä½¿ç”¨ä»‹ç»ã€‹</a>ã€‚</p>
</blockquote>
<p>é’ˆå¯¹è¿™ä¸€å°æ®µç¤ºä¾‹ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">store := NewStore()</span><br><span class="line">store.Create(ctx, user)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥å°†ç¤ºä¾‹ä»£ç ä¿®æ”¹æˆè¿™æ ·ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> userStore <span class="keyword">struct</span> &#123;</span><br><span class="line">	db *gorm.DB</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStore</span><span class="params">(db *gorm.DB)</span> *<span class="title">userStore</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;userStore&#123;db: db&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *userStore)</span> <span class="title">Create</span><span class="params">(ctx context.Context, user *model.UserM)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> u.db.Create(&amp;user).Error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹åç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘å°† <code>*gorm.DB</code> å¯¹è±¡ <code>db</code> çš„å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œç§»åŠ¨åˆ°äº† <code>NewStore</code> å‡½æ•°å¤–é¢ï¼Œåœ¨è°ƒç”¨ <code>NewStore</code> åˆ›å»º <code>*userStore</code> å¯¹è±¡ <code>store</code> æ—¶ï¼Œå°†å…¶é€šè¿‡å‚æ•°å½¢å¼ä¼ é€’è¿›æ¥ã€‚</p>
<p>ç°åœ¨ï¼Œå¦‚æœè¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db := NewDB()</span><br><span class="line">store := NewStore(db)</span><br><span class="line">store.Create(ctx, user)</span><br></pre></td></tr></table></figure>

<p>æ²¡é”™ï¼Œæˆ‘ä»¬å·²ç»åœ¨ä½¿ç”¨<strong>ä¾èµ–æ³¨å…¥</strong>äº†ã€‚</p>
<p>æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ <code>store.Create(ctx, user)</code> åˆ›å»ºç”¨æˆ·ã€‚ä½†æ„é€  <code>store</code> æ—¶ï¼Œ<code>*userStore</code> <strong>ä¾èµ–</strong> <code>*gorm.DB</code>ï¼Œæˆ‘ä»¬ä½¿ç”¨æ„é€ å‡½æ•° <code>NewStore</code> åˆ›å»º <code>*userStore</code> å¯¹è±¡ï¼Œå¹¶ä¸”å°†å®ƒçš„<strong>ä¾èµ–å¯¹è±¡</strong> <code>*gorm.DB</code> é€šè¿‡å‡½æ•°å‚æ•°çš„å½¢å¼<strong>æ³¨å…¥</strong>è¿›æ¥ï¼Œè¿™ç§ç¼–ç¨‹æ€æƒ³ï¼Œå°±å«ã€Œä¾èµ–æ³¨å…¥ã€ã€‚</p>
<p>å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¹³æ—¶åœ¨ç¼–å†™ Go ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæ˜¯ä¸æ˜¯ç»å¸¸å°†æŸä¸ªæ–¹æ³•çš„ä¾èµ–é¡¹é€šè¿‡å‚æ•°ä¼ é€’è¿›æ¥ï¼Œè€Œéåœ¨æ–¹æ³•å†…éƒ¨å®ä¾‹åŒ–ï¼Œè¿™å°±æ˜¯åœ¨ä½¿ç”¨ä¾èµ–æ³¨å…¥ç¼–å†™ä»£ç ã€‚</p>
<p>æˆ‘åœ¨æ–‡ç« <a href="https://jianghushinian.cn/2023/07/22/how-to-write-testable-code-in-go/#%E4%BD%BF%E7%94%A8%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E6%9D%A5%E8%A7%A3%E5%86%B3%E5%A4%96%E9%83%A8%E4%BE%9D%E8%B5%96" target="_blank" rel="noopener">ã€Šåœ¨ Go ä¸­å¦‚ä½•ç¼–å†™å‡ºå¯æµ‹è¯•çš„ä»£ç ã€‹</a>ä¸­å°±æœ‰æåˆ°<strong>å¦‚ä½•ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥è§£å†³å¤–éƒ¨ä¾èµ–é—®é¢˜</strong>ï¼Œä½ å¯ä»¥ç‚¹å‡»æ–‡ç« è¿›è¡Œé˜…è¯»ã€‚</p>
<p>åœ¨ Go ä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒç›®çš„ï¼Œå°±æ˜¯ä¸ºäº†è§£è€¦ä»£ç ã€‚è¿™æ ·åšçš„ä¸»è¦å¥½å¤„æ˜¯ï¼š</p>
<ol>
<li>æ–¹ä¾¿æµ‹è¯•ã€‚ä¾èµ–ç”±å¤–éƒ¨æ³¨å…¥ï¼Œæ–¹ä¾¿ä½¿ç”¨ <code>fake object</code> æ¥æ›¿æ¢ä¾èµ–é¡¹ã€‚</li>
<li>æ¯ä¸ªå¯¹è±¡ä»…éœ€è¦åˆå§‹åŒ–ä¸€æ¬¡ï¼Œå…¶ä»–æ–¹æ³•éƒ½å¯ä»¥å¤ç”¨ã€‚æ¯”å¦‚ä½¿ç”¨ <code>db := NewDB()</code> åˆå§‹åŒ–å¾—åˆ°ä¸€ä¸ª <code>*gorm.DB</code> å¯¹è±¡ï¼Œåœ¨ <code>NewUserStore(db)</code> æ—¶å¯ä»¥ä½¿ç”¨ï¼Œåœ¨ <code>NewPostStore(db)</code> æ—¶è¿˜å¯ä»¥ä½¿ç”¨ã€‚</li>
</ol>
<blockquote>
<p>NOTE: æˆ‘ä¸å¤ªå–œæ¬¢ä½¿ç”¨æ¯”è¾ƒå®˜æ–¹çš„è¯æœ¯æ¥è®²è§£æŠ€æœ¯ï¼Œå› ä¸ºæœ¬æ¥æŠ€æœ¯å°±éœ€è¦ç†è§£æˆæœ¬ï¼Œè€Œå®˜æ–¹çš„å®šä¹‰å¾€å¾€æ™¦æ¶©éš¾æ‡‚ã€‚ä¸ºäº†é™ä½è¯»è€…çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œæˆ‘æ›´å–œæ¬¢ç”¨ç™½è¯è®²è§£ã€‚<br>ä½†è¯´åˆ°ã€Œä¾èµ–æ³¨å…¥ã€ï¼Œå®šä¼šæœ‰äººæåŠã€Œæ§åˆ¶åè½¬ã€ã€‚ä¸ºäº†ä¸ä¸€äº›è®©è¯»è€…äº§ç”Ÿå›°æƒ‘ï¼Œè¿™é‡Œç®€å•è¯´æ˜ä¸‹æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥çš„å…³ç³»ï¼š<a href="https://zh.wikipedia.org/wiki/æ§åˆ¶åè½¬" target="_blank" rel="noopener">æ§åˆ¶åè½¬</a>ï¼ˆè‹±è¯­ï¼šInversion of Controlï¼Œç¼©å†™ä¸º IoCï¼‰ï¼Œæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œå¯ä»¥ç”¨æ¥å‡ä½è®¡ç®—æœºä»£ç ä¹‹é—´çš„è€¦åˆåº¦ã€‚å…¶ä¸­æœ€å¸¸è§çš„æ–¹å¼å«åš<a href="https://zh.wikipedia.org/wiki/ä¾èµ–æ³¨å…¥" target="_blank" rel="noopener">ä¾èµ–æ³¨å…¥</a>ï¼ˆdependency injectionï¼Œç¼©å†™ä¸º DIï¼‰ã€‚<br>æˆ‘ä»¬å¯ä»¥ç®€å•çš„å°†æ§åˆ¶åè½¬ç†è§£ä¸ºä¸€ç§æ€æƒ³ï¼Œè€Œä¾èµ–æ³¨å…¥æ˜¯è¿™ä¸€æ€æƒ³çš„å…·ä½“å®ç°æ–¹å¼ã€‚</p>
</blockquote>
<h3 id="ä¾èµ–æ³¨å…¥å·¥å…·-Wire-ç®€ä»‹"><a href="#ä¾èµ–æ³¨å…¥å·¥å…·-Wire-ç®€ä»‹" class="headerlink" title="ä¾èµ–æ³¨å…¥å·¥å…· Wire ç®€ä»‹"></a>ä¾èµ–æ³¨å…¥å·¥å…· Wire ç®€ä»‹</h3><p>wire æ˜¯ä¸€ä¸ªç”± Google å¼€å‘çš„è‡ªåŠ¨ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œä¸“é—¨ç”¨äº Go è¯­è¨€ã€‚wire é€šè¿‡<strong>ä»£ç ç”Ÿæˆè€Œéè¿è¡Œæ—¶åå°„</strong>æ¥å®ç°ä¾èµ–æ³¨å…¥ï¼Œè¿™ä¸è®¸å¤šå…¶ä»–è¯­è¨€ä¸­çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ä¸åŒã€‚è¿™ç§æ–¹æ³•ä½¿å¾—æ³¨å…¥çš„ä»£ç åœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šï¼Œä»è€Œæé«˜äº†æ€§èƒ½å¹¶ä¿è¯äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚</p>
<h4 id="å®‰è£…-Wire"><a href="#å®‰è£…-Wire" class="headerlink" title="å®‰è£… Wire"></a>å®‰è£… Wire</h4><p>wire åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„ Go åŒ…ï¼Œç”¨äºåœ¨ä»£ç ä¸­å¼•ç”¨ wire ä»£ç ï¼›å¦ä¸€ä¸ªæ˜¯å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç”Ÿæˆä¾èµ–æ³¨å…¥ä»£ç ã€‚</p>
<ul>
<li>åœ¨é¡¹ç›®ä¸­å¯¼å…¥éœ€è¦å…ˆé€šè¿‡ <code>go get</code> è·å– wire ä¾èµ–åŒ…ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go get -u github.com/google/wire</span><br></pre></td></tr></table></figure>

<p>åœ¨ Go ä»£ç ä¸­åƒå…¶ä»– Go åŒ…ä¸€æ ·ä½¿ç”¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"github.com/google/wire"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨ <code>go install</code> å¯ä»¥å®‰è£… wire å‘½ä»¤å·¥å…·ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go install github.com/google/wire/cmd/wire</span><br></pre></td></tr></table></figure>

<p>å®‰è£…åé€šè¿‡ <code>--help</code> æ ‡å¿—æ‰§è¡Œ <code>wire</code> å‘½ä»¤æŸ¥çœ‹å…¶æ”¯æŒçš„æ‰€æœ‰å­å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ wire --<span class="built_in">help</span>   </span><br><span class="line">Usage: wire &lt;flags&gt; &lt;subcommand&gt; &lt;subcommand args&gt;</span><br><span class="line"></span><br><span class="line">Subcommands:</span><br><span class="line">        check            <span class="built_in">print</span> any Wire errors found</span><br><span class="line">        commands         list all <span class="built_in">command</span> names</span><br><span class="line">        diff             output a diff between existing wire_gen.go files and what gen would generate</span><br><span class="line">        flags            describe all known top-level flags</span><br><span class="line">        gen              generate the wire_gen.go file <span class="keyword">for</span> each package</span><br><span class="line">        <span class="built_in">help</span>             describe subcommands and their syntax</span><br><span class="line">        show             describe all top-level provider sets</span><br></pre></td></tr></table></figure>

<p>ç”±äºç»å¤§å¤šæ•° wire å­å‘½ä»¤ä¸å¸¸ç”¨ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†ä¼šæ”¾åœ¨æœ¬æ–‡æœ€åå†æ¥è®²è§£ã€‚</p>
<h3 id="Wire-å¿«é€Ÿå¼€å§‹"><a href="#Wire-å¿«é€Ÿå¼€å§‹" class="headerlink" title="Wire å¿«é€Ÿå¼€å§‹"></a>Wire å¿«é€Ÿå¼€å§‹</h3><p>ç¤ºä¾‹ç¨‹åº <code>main.go</code> ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Message <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMessage</span><span class="params">()</span> <span class="title">Message</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Message(<span class="string">"Hi there!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Greeter <span class="keyword">struct</span> &#123;</span><br><span class="line">	Message Message</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewGreeter</span><span class="params">(m Message)</span> <span class="title">Greeter</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Greeter&#123;Message: m&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g Greeter)</span> <span class="title">Greet</span><span class="params">()</span> <span class="title">Message</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> g.Message</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Event <span class="keyword">struct</span> &#123;</span><br><span class="line">	Greeter Greeter</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewEvent</span><span class="params">(g Greeter)</span> <span class="title">Event</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Event&#123;Greeter: g&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e Event)</span> <span class="title">Start</span><span class="params">()</span></span> &#123;</span><br><span class="line">	msg := e.Greeter.Greet()</span><br><span class="line">	fmt.Println(msg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ä»£ç å¾ˆå¥½ç†è§£ï¼Œå®šä¹‰äº† <code>Message</code> ç±»å‹æ˜¯ <code>string</code> çš„ç±»å‹åˆ«åã€‚å®šä¹‰äº† <code>Greeter</code> ç±»å‹åŠå…¶æ„é€ å‡½æ•° <code>NewGreeter</code>ï¼Œå¹¶ä¸”æ¥æ”¶ <code>Message</code> ä½œä¸ºå‚æ•°ï¼Œ<code>Greeter.Greet</code> æ–¹æ³•ä¼šè¿”å› <code>Message</code> ä¿¡æ¯ã€‚æœ€åè¿˜å®šä¹‰äº†ä¸€ä¸ª <code>Event</code> ç±»å‹ï¼Œå®ƒå­˜å‚¨äº† <code>Greeter</code>ï¼Œ<code>Greeter</code> é€šè¿‡æ„é€ å‡½æ•° <code>NewEvent</code> å‚æ•°ä¼ é€’è¿›æ¥ï¼Œ<code>Event.Start</code> æ–¹æ³•ä¼šä»£ç†åˆ° <code>Greeter.Greet</code> æ–¹æ³•ã€‚</p>
<p>å®šä¹‰å¦‚ä¸‹ <code>main</code> å‡½æ•°æ¥æ‰§è¡Œè¿™ä¸ªç¤ºä¾‹ç¨‹åºï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	message := NewMessage()</span><br><span class="line">	greeter := NewGreeter(message)</span><br><span class="line">	event := NewEvent(greeter)</span><br><span class="line"></span><br><span class="line">	event.Start()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç¤ºä¾‹ä»£ç ï¼Œå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run main.go</span><br><span class="line">Hi there!</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°ï¼Œ<code>main</code> å‡½æ•°å†…éƒ¨çš„ä»£ç æœ‰ç€æ˜æ˜¾çš„ä¾èµ–å…³ç³»ï¼Œ<code>NewEvent</code> ä¾èµ– <code>NewGreeter</code>ï¼Œ<code>NewGreeter</code> åˆä¾èµ– <code>NewMessage</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NewEvent -&gt; NewGreeter -&gt; NewMessage</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å°†è¿™éƒ¨åˆ†ä»£ç è¿›è¡ŒæŠ½ç¦»ï¼Œå°è£…åˆ° <code>InitializeEvent</code> å‡½æ•°ä¸­ï¼Œä¿æŒå…¥å£å‡½æ•° <code>main</code> è¶³å¤Ÿæ•´æ´ï¼Œä¿®æ”¹åä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">()</span> <span class="title">Event</span></span> &#123;</span><br><span class="line">	message := NewMessage()</span><br><span class="line">	greeter := NewGreeter(message)</span><br><span class="line">	event := NewEvent(greeter)</span><br><span class="line">	<span class="keyword">return</span> event</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	event := InitializeEvent()</span><br><span class="line">	event.Start()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æ˜¯æ—¶å€™è®© wire ç™»åœºäº†ï¼Œåœ¨ <code>main.go</code> åŒçº§ç›®å½•åˆ›å»º <code>wire.go</code> æ–‡ä»¶ï¼ˆè¿™æ˜¯ä¸€ä¸ªçº¦å®šä¿—ç§°çš„æ–‡ä»¶å‘½åï¼Œä¸æ˜¯å¼ºåˆ¶çº¦æŸï¼‰ï¼š </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:build wireinject</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"github.com/google/wire"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">()</span> <span class="title">Event</span></span> &#123;</span><br><span class="line">	wire.Build(NewEvent, NewGreeter, NewMessage)</span><br><span class="line">	<span class="keyword">return</span> Event&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å°† <code>main.go</code> æ–‡ä»¶ä¸­çš„ <code>InitializeEvent</code> å‡½æ•°è¿ç§»è¿‡æ¥ï¼Œå¹¶ä¸”ä¿®æ”¹äº†å†…éƒ¨é€»è¾‘ï¼Œä¸å†æ‰‹åŠ¨è°ƒç”¨æ¯ä¸ªæ„é€ å‡½æ•°ï¼Œè€Œæ˜¯å°†å®ƒä»¬ä¾æ¬¡ä¼ é€’ç»™ <code>wire.Build</code> å‡½æ•°ï¼Œç„¶åä½¿ç”¨ <code>return</code> è¿”å›ä¸€ä¸ªç©ºçš„ <code>Event{}</code> å¯¹è±¡ã€‚</p>
<p>ç°åœ¨åœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡Œ <code>wire</code> å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wire gen .    </span><br><span class="line">wire: github.com/jianghushinian/blog-go-example/wire/getting-started: wrote /Users/jianghushinian/projects/blog-go-example/wire/getting-started/wire_gen.go</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>gen</code> æ˜¯ <code>wire</code> çš„å­å‘½ä»¤ï¼Œä»–ä¼šæ‰«ææŒ‡å®šåŒ…ä¸­ä½¿ç”¨äº† <code>wire.Build</code> çš„ä»£ç ï¼Œç„¶åä¸ºå…¶ç”Ÿæˆä¸€ä¸ª <code>wire_gen.go</code> çš„æ–‡ä»¶ã€‚</li>
<li><code>.</code> è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œç”¨äºæŒ‡å®šåŒ…ï¼Œä¸æŒ‡å®šçš„è¯é»˜è®¤å°±æ˜¯å½“å‰ç›®å½•ã€‚å¦‚æœé¡¹ç›®ä¸‹æœ‰å¾ˆå¤šåŒ…ï¼Œå¯ä»¥ä½¿ç”¨ <code>./...</code> è¡¨ç¤ºå…¨éƒ¨åŒ…ï¼Œè¿™ä¸ªå‚æ•°å…¶å®è·Ÿæˆ‘ä»¬æ‰§è¡Œ <code>go test</code> æµ‹è¯•æ—¶æ˜¯ä¸€ä¸ªé“ç†ã€‚</li>
</ul>
<p>æ ¹æ®è¾“å‡ºç»“æœå¯ä»¥å‘ç°ï¼Œ<code>wire</code> å‘½ä»¤ä¸ºæˆ‘ä»¬åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆäº† <code>wire_gen.go</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Code generated by Wire. DO NOT EDIT.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//go:generate go run -mod=mod github.com/google/wire/cmd/wire</span></span><br><span class="line"><span class="comment">//go:build !wireinject</span></span><br><span class="line"><span class="comment">// +build !wireinject</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// Injectors from wire.go:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">()</span> <span class="title">Event</span></span> &#123;</span><br><span class="line">	message := NewMessage()</span><br><span class="line">	greeter := NewGreeter(message)</span><br><span class="line">	event := NewEvent(greeter)</span><br><span class="line">	<span class="keyword">return</span> event</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†ï¼Œ<code>wire</code> ä¸ºæˆ‘ä»¬ç”Ÿæˆäº† <code>InitializeEvent</code> å‡½æ•°çš„ä»£ç ï¼Œå¹¶ä¸”è·Ÿæˆ‘ä»¬è‡ªå·±å®ç°çš„ä»£ç ä¸€æ¨¡ä¸€æ ·ã€‚</p>
<p>è¿™å°±æ˜¯ wire çš„å¨åŠ›ï¼Œå®ƒå¯ä»¥ä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆä¾èµ–æ³¨å…¥ä»£ç ï¼Œåªéœ€è¦æˆ‘ä»¬å°†æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆè¿™é‡Œæ˜¯å‡ ä¸ªæ„é€ å‡½æ•°ï¼‰ä¼ ç»™ <code>wire.Build</code> å³å¯ã€‚</p>
<p>ç”±äºç°åœ¨å½“å‰ç›®å½•ä¸‹å­˜åœ¨ 3 ä¸ª <code>.go</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tree    </span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ go.mod</span><br><span class="line">â”œâ”€â”€ go.sum</span><br><span class="line">â”œâ”€â”€ main.go</span><br><span class="line">â”œâ”€â”€ wire.go</span><br><span class="line">â””â”€â”€ wire_gen.go</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ä¸èƒ½å†ä½¿ç”¨ <code>go run main.go</code> æ¥æ‰§è¡Œç¤ºä¾‹ä»£ç äº†ï¼Œå¯ä»¥ä½¿ç”¨ <code>go run .</code> æ¥æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run .</span><br><span class="line">Hi there!</span><br></pre></td></tr></table></figure>

<p>ç»†å¿ƒçš„ä½ å¯èƒ½ä¼šè§‰å¾—ç–‘æƒ‘ğŸ¤”ï¼Œä»£ç ä¸­æœ‰ä¸¤å¤„ <code>InitializeEvent</code> å‡½æ•°çš„å®šä¹‰ï¼Œç¨‹åºç¼–è¯‘æ‰§è¡Œçš„æ—¶å€™ä¸ä¼šæŠ¥é”™å—ï¼Ÿ</p>
<p>æˆ‘ä»¬åœ¨ <code>wire.go</code> ä¸­å®šä¹‰äº† <code>InitializeEvent</code> å‡½æ•°ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">()</span> <span class="title">Event</span></span> &#123;</span><br><span class="line">	wire.Build(NewEvent, NewGreeter, NewMessage)</span><br><span class="line">	<span class="keyword">return</span> Event&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶å <code>wire</code> å‘½ä»¤å¸®æˆ‘ä»¬åœ¨ <code>wire_gen.go</code> ä¸­ç”Ÿæˆäº†æ–°çš„ <code>InitializeEvent</code> å‡½æ•°ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">()</span> <span class="title">Event</span></span> &#123;</span><br><span class="line">	message := NewMessage()</span><br><span class="line">	greeter := NewGreeter(message)</span><br><span class="line">	event := NewEvent(greeter)</span><br><span class="line">	<span class="keyword">return</span> event</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œä¸”è¿™äºŒè€…éƒ½æ˜¯åœ¨åŒä¸€ä¸ªåŒ…ä¸‹ã€‚</p>
<p>ç¨‹åºæ²¡æœ‰ç¼–è¯‘æŠ¥é”™ï¼Œä¸»è¦å–å†³äº <code>wire.go</code> å’Œ <code>wire_gen.go</code> æ–‡ä»¶ä¸­çš„ <code>//go:build</code> æ³¨é‡Šã€‚</p>
<p>åœ¨ <code>wire.go</code> æ–‡ä»¶ä¸­ï¼Œæ³¨é‡Šä¸ºï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:build wireinject</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆ <code>//go:build</code> å«<a href="https://pkg.go.dev/go/build#hdr-Build_Constraints" target="_blank" rel="noopener">æ„å»ºçº¦æŸ</a>ï¼ˆbuild constraintï¼‰æˆ–æ„å»ºæ ‡è®°ï¼ˆbuild tagï¼‰ï¼Œæ˜¯ä¸€ä¸ªå¿…é¡»æ”¾åœ¨ <code>.go</code> æ–‡ä»¶æœ€å¼€å§‹çš„æ³¨é‡Šä»£ç ã€‚æœ‰äº†å®ƒä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘Šè¯‰ <code>go build</code> å¦‚ä½•æ¥æ„å»ºä»£ç ã€‚</p>
<p>å…¶æ¬¡ï¼Œ<code>wireinject</code> æ˜¯ä¼ é€’ç»™æ„å»ºçº¦æŸçš„é€‰é¡¹ã€‚é€‰é¡¹å°±ç›¸å½“äºä¸€ä¸ª <code>if</code> åˆ¤æ–­æ¡ä»¶ï¼Œå¯ä»¥æ ¹æ®é€‰é¡¹æ¥å®šåˆ¶æ„å»ºæ—¶å¦‚ä½•å¤„ç† Go æ–‡ä»¶ã€‚</p>
<p>è¿™ä¸ªæ„å»ºçº¦æŸæœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p>
<ul>
<li>å°†æ­¤æ–‡ä»¶æ ‡è®°æ–‡ä»¶ä¸º <code>wire</code> å¤„ç†çš„ç›®æ ‡ï¼š<code>//go:build wireinject</code> å‘Šè¯‰ <code>wire</code> å·¥å…·åŠå¼€å‘è€…ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä½¿ç”¨ <code>wire</code> è¿›è¡Œä¾èµ–æ³¨å…¥çš„è®¾ç½®ã€‚å³è¿™é€šå¸¸æ„å‘³ç€æ–‡ä»¶ä¸­åŒ…å«äº† <code>wire.Build</code> å‡½æ•°è°ƒç”¨ã€‚æœ‰äº†å®ƒï¼Œæ–‡ä»¶æ‰ä¼šè¢« <code>wire</code> è¯†åˆ«ã€‚</li>
<li>æ¡ä»¶ç¼–è¯‘ï¼šç¡®ä¿åœ¨æ­£å¸¸çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¸¦æœ‰è¿™ä¸ªæ„å»ºçº¦æŸçš„æ–‡ä»¶ä¸ä¼šè¢«ç¼–è¯‘è¿›æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚å®ƒåªæœ‰åœ¨ä½¿ç”¨ <code>wire</code> å·¥å…·ç”Ÿæˆä¾èµ–æ³¨å…¥ä»£ç æ—¶æ‰è¢«å¤„ç†ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»£ç ä¸ä¼šç¼–è¯‘æŠ¥é”™ï¼Œå…¶å® <code>wire.go</code> æ–‡ä»¶åªæ˜¯ç»™ <code>wire</code> å‘½ä»¤ç”¨çš„ï¼Œ<code>go run .</code> æ‰§è¡Œçš„æ˜¯ <code>main.go</code> å’Œ <code>wire_gen.go</code> ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¼šå¿½ç•¥ <code>wire.go</code>ã€‚</li>
</ul>
<p>æ³¨æ„âš ï¸ï¼š<code>//go:build wireinject</code> å’Œ <code>package main</code> ä¹‹é—´éœ€è¦ä¿ç•™ä¸€ä¸ªç©ºè¡Œï¼Œå¦åˆ™ç¨‹åºä¼šæŠ¥é”™ã€‚ä½ è®°ä½å°±è¡Œï¼Œä¸å¿…è¿‡äºçº ç»“äºæ­¤ï¼Œè¿™ä¸ªé—®é¢˜åœ¨ wire ä»“åº“çš„ <a href="https://github.com/google/wire/issues/117" target="_blank" rel="noopener">issues 117</a> ä¸­ä¹Ÿæœ‰æåŠã€‚</p>
<p>æˆ‘ä»¬å†æ¥çœ‹ <code>wire_gen.go</code> æ–‡ä»¶ï¼Œæ³¨é‡Šä¸ºï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Code generated by Wire. DO NOT EDIT.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//go:generate go run -mod=mod github.com/google/wire/cmd/wire</span></span><br><span class="line"><span class="comment">//go:build !wireinject</span></span><br><span class="line"><span class="comment">// +build !wireinject</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€è¡Œæ³¨é‡Šä»…ä½œä¸ºæç¤ºç”¨ï¼Œæ— ç‰¹æ®Šç”¨é€”ã€‚</p>
<p><code>//go:generate</code> è¿™è¡Œæ³¨é‡Šæ˜¯ä¸€ä¸ª <a href="https://go.dev/blog/generate" target="_blank" rel="noopener">go generate</a> æŒ‡ä»¤ã€‚<code>go generate</code> æ˜¯ä¸€ä¸ªç”± Go å·¥å…·é“¾æä¾›çš„å‘½ä»¤ï¼Œç”¨äºåœ¨ç¼–è¯‘å‰è‡ªåŠ¨æ‰§è¡Œç”Ÿæˆä»£ç çš„å‘½ä»¤ã€‚è¿™ä¸ªç‰¹å®šçš„ç”ŸæˆæŒ‡ä»¤å‘Šè¯‰ Go åœ¨æ‰§è¡Œ <code>go generate</code> å‘½ä»¤æ—¶ï¼Œè¿è¡Œ <code>wire</code> å·¥å…·æ¥è‡ªåŠ¨ç”Ÿæˆæˆ–æ›´æ–° <code>wire_gen.go</code> æ–‡ä»¶ã€‚</p>
<p><code>go run -mod=mod github.com/google/wire/cmd/wire</code> è¿™éƒ¨åˆ†æŒ‡ä»¤è¿è¡Œ <code>wire</code> å‘½ä»¤ï¼Œå…¶ä¸­ <code>-mod=mod</code> ç¡®ä¿ä½¿ç”¨çš„æ˜¯é¡¹ç›®çš„ <code>go.mod</code> æ–‡ä»¶ä¸­æŒ‡å®šçš„ä¾èµ–ç‰ˆæœ¬ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥éªŒè¯ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go generate</span><br><span class="line">wire: github.com/jianghushinian/blog-go-example/wire/getting-started: wrote /Users/jianghushinian/projects/blog-go-example/wire/getting-started/wire_gen.go</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œ <code>go generate</code> ç¡®å®ä¼šè‡ªåŠ¨æ‰§è¡Œ <code>wire</code> å‘½ä»¤ã€‚</p>
<p>æ³¨é‡Š <code>//go:build !wireinject</code> åŒæ ·æ˜¯ä¸€ä¸ªæ„å»ºçº¦æŸã€‚ä¸ <code>wire.go</code> ä¸­çš„çº¦æŸä¸åŒï¼Œè¿™é‡Œçš„ <code>!wireinject</code> å¤šäº†ä¸€ä¸ª <code>!</code>ï¼Œ<code>!</code> åœ¨ç¼–ç¨‹ä¸­é€šå¸¸æ˜¯å–åçš„æ„æ€ï¼Œæ‰€ä»¥å®ƒç”¨æ¥å‘Šè¯‰ <code>wire</code> å¿½ç•¥æ­¤æ–‡ä»¶ã€‚å› ä¸ºè¿™ä¸ªæ–‡ä»¶æ˜¯æœ€ç»ˆæ‰§è¡Œçš„ä»£ç ï¼Œ<code>wire</code> å¹¶ä¸éœ€è¦çŸ¥é“æ­¤æ–‡ä»¶çš„å­˜åœ¨ã€‚</p>
<p>æœ€åä¸€ä¸ªæ³¨é‡Š <code>// +build !wireinject</code> å…¶å®è¿˜æ˜¯ä¸€ä¸ªæ„å»ºçº¦æŸï¼Œåªä¸è¿‡è¿™æ˜¯æ—§ç‰ˆæœ¬çš„æ¡ä»¶ç¼–è¯‘æ ‡è®°ï¼ˆåœ¨ Go 1.17 ç‰ˆæœ¬ä¹‹å‰ä½¿ç”¨ï¼‰ã€‚å®ƒçš„ä½œç”¨ä¸ <code>//go:build !wireinject</code> ç›¸åŒï¼Œç¡®ä¿å‘åå…¼å®¹æ€§ã€‚è¿™æ„å‘³ç€åœ¨è¾ƒè€çš„ Go ç‰ˆæœ¬ä¸­ï¼Œç¼–è¯‘æ¡ä»¶ä¹Ÿèƒ½è¢«æ­£ç¡®å¤„ç†ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¾èµ–æ³¨å…¥å·¥å…·ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¾èµ–æ³¨å…¥å·¥å…·ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¾èµ–æ³¨å…¥å·¥å…·ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¾èµ–æ³¨å…¥å·¥å…·ï¼Ÿ</h3><p>å‰æ–‡è®²è§£äº†ä¾èµ–æ³¨å…¥æ€æƒ³ï¼Œä»¥åŠé€šè¿‡<a href="#Wire-å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a>çš„ç¤ºä¾‹ç¨‹åºï¼Œæˆ‘ä»¬æé€Ÿå…¥é—¨äº† wire ä¾èµ–æ³¨å…¥å·¥å…·çš„ä½¿ç”¨ã€‚</p>
<p>ä¸è¿‡ç›´åˆ°åˆ°ç°åœ¨æˆ‘ä»¬éƒ½è¿˜æ²¡æœ‰è®¨è®ºè¿‡ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¾èµ–æ³¨å…¥å·¥å…·ï¼Ÿ</p>
<p>å…¶å®é€šè¿‡å‰æ–‡çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬åº”è¯¥å·²ç»ä½“ä¼šåˆ°ï¼Œwire æœ€å¤§çš„ä½œç”¨å°±æ˜¯è§£æ”¾åŒæ‰‹ï¼Œæé«˜ç”Ÿäº§åŠ›ã€‚</p>
<p>ç¤ºä¾‹ç¨‹åºä¸­ï¼Œä¾èµ–é“¾åªæœ‰ 3 ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªä¸­å¤§å‹é¡¹ç›®ï¼Œä¾èµ–å¯¹è±¡å¯èƒ½æœ‰å‡ åä¸ªï¼Œwire çš„ä½œç”¨ä¼šæ„ˆåŠ æ˜æ˜¾ã€‚</p>
<p>ä½¿ç”¨ä¾èµ–æ³¨å…¥æ€æƒ³å¯ä»¥æœ‰æ•ˆçš„è§£è€¦ä»£ç ï¼Œé‚£ä¹ˆä½¿ç”¨ä¾èµ–æ³¨å…¥å·¥å…·åˆ™è¿›ä¸€æ­¥æé«˜äº†ç”Ÿäº§åŠ›ã€‚æˆ‘ä»¬æ— éœ€æ‰‹åŠ¨å®ä¾‹åŒ–æ‰€æœ‰çš„ä¾èµ–å¯¹è±¡ï¼Œä»…éœ€è¦ç¼–å†™å‡½æ•°å£°æ˜ï¼Œå°†ä¾èµ–é¡¹æ‰”ç»™ <code>wire.Build</code>ï¼Œ<code>wire</code> å‘½ä»¤å°±èƒ½è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œå¯è§ wire æ˜¯æˆ‘ä»¬å·æ‡’çš„åˆ©å™¨ï¼Œæ¯•ç«Ÿæ‡’æ‰æ˜¯ç¨‹åºå‘˜çš„ç¬¬ä¸€é©±åŠ¨åŠ› :)ã€‚</p>
<p>å¦‚æœä½ å¯¹ä¾èµ–æ³¨å…¥å·¥å…·çš„ä½œç”¨è¿˜å­˜åœ¨è´¨ç–‘ï¼Œè¯·æ¥ç€å¾€ä¸‹çœ‹ï¼</p>
<h3 id="Wire-æ ¸å¿ƒæ¦‚å¿µ"><a href="#Wire-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="Wire æ ¸å¿ƒæ¦‚å¿µ"></a>Wire æ ¸å¿ƒæ¦‚å¿µ</h3><p>æˆ‘ä»¬å·²ç»é€šè¿‡<a href="#Wire-å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a>ç¤ºä¾‹æ¼”ç¤ºäº† wire çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œç°åœ¨æ˜¯æ—¶å€™æ­£å¼ä»‹ç»ä¸‹ wire ä¸­çš„æ¦‚å¿µäº†ã€‚</p>
<p>åœ¨ wire ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š<code>providers</code>ï¼ˆæä¾›è€…ï¼‰å’Œ <code>injectors</code>ï¼ˆæ³¨å…¥å™¨ï¼‰ã€‚</p>
<p>è¿™ä¸¤ä¸ªæ¦‚å¿µä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå‰æ–‡ä¸­çš„ <code>NewEvent</code>ã€<code>NewGreeter</code>ã€<code>NewMessage</code> éƒ½æ˜¯ä¸€ä¸ª <code>provider</code>ã€‚ç®€å•ä¸€å¥è¯ï¼š<code>provider</code> å°±æ˜¯ä¸€ä¸ªå¯ä»¥<strong>äº§ç”Ÿå€¼çš„å‡½æ•°</strong>ï¼Œè¿™äº›å‡½æ•°éƒ½æ˜¯<strong>æ™®é€šçš„ Go å‡½æ•°</strong>ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>provider</code> å¿…é¡»æ˜¯å¯å¯¼å‡ºçš„å‡½æ•°ï¼Œå³å‡½æ•°åç§°é¦–å­—æ¯å¤§å†™ã€‚</p>
<p>è€Œ <code>InitializeEvent</code> å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª <code>injector</code>ã€‚<code>injector</code> æ˜¯ä¸€ä¸ªæŒ‰ä¾èµ–é¡ºåºè°ƒç”¨ <code>provider</code> çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°å£°æ˜çš„ä¸»ä½“æ˜¯å¯¹ <code>wire.Build</code> çš„è°ƒç”¨ã€‚ä½¿ç”¨ wire æ—¶ï¼Œæˆ‘ä»¬ä»…éœ€ç¼–å†™ <code>injector</code> çš„ç­¾åï¼Œç„¶åç”± <code>wire</code> å‘½ä»¤ç”Ÿæˆå‡½æ•°ä½“ã€‚</p>
<h3 id="Wire-é«˜çº§ç”¨æ³•"><a href="#Wire-é«˜çº§ç”¨æ³•" class="headerlink" title="Wire é«˜çº§ç”¨æ³•"></a>Wire é«˜çº§ç”¨æ³•</h3><p>wire è¿˜æœ‰å¾ˆå¤šé«˜çº§ç”¨æ³•ï¼Œå€¼å¾—ä»‹ç»ä¸€ä¸‹ã€‚</p>
<h4 id="injector-å‡½æ•°å‚æ•°å’Œè¿”å›é”™è¯¯"><a href="#injector-å‡½æ•°å‚æ•°å’Œè¿”å›é”™è¯¯" class="headerlink" title="injector å‡½æ•°å‚æ•°å’Œè¿”å›é”™è¯¯"></a>injector å‡½æ•°å‚æ•°å’Œè¿”å›é”™è¯¯</h4><p>é¦–å…ˆæ˜¯ <code>injector</code> å‡½æ•°æ”¯æŒä¼ å‚å’Œè¿”å› <code>error</code>ã€‚</p>
<p>ä¿®æ”¹ç¤ºä¾‹ç¨‹åºä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> Message string</span><br><span class="line"></span><br><span class="line">// æ¥æ”¶å‚æ•°ä½œä¸ºæ¶ˆæ¯å†…å®¹</span><br><span class="line">func NewMessage(phrase string) Message &#123;</span><br><span class="line">	<span class="built_in">return</span> Message(phrase)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> Greeter struct &#123;</span><br><span class="line">	Message Message</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func NewGreeter(m Message) Greeter &#123;</span><br><span class="line">	<span class="built_in">return</span> Greeter&#123;Message: m&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (g Greeter) Greet() Message &#123;</span><br><span class="line">	<span class="built_in">return</span> g.Message</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> Event struct &#123;</span><br><span class="line">	Greeter Greeter</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¢åŠ è¿”å›é”™è¯¯ä¿¡æ¯</span><br><span class="line">func NewEvent(g Greeter) (Event, error) &#123;</span><br><span class="line">	// æ¨¡æ‹Ÿåˆ›å»º Event æŠ¥é”™</span><br><span class="line">	<span class="keyword">if</span> time.Now().Unix()%2 == 0 &#123;</span><br><span class="line">		<span class="built_in">return</span> Event&#123;&#125;, errors.New(<span class="string">"new event error"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">return</span> Event&#123;Greeter: g&#125;, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (e Event) <span class="function"><span class="title">Start</span></span>() &#123;</span><br><span class="line">	msg := e.Greeter.Greet()</span><br><span class="line">	fmt.Println(msg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸»è¦ä¿®æ”¹äº†ä¸¤å¤„ä»£ç ï¼Œ<code>NewMessage</code> æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°ä½œä¸ºæ¶ˆæ¯å†…å®¹ï¼Œåœ¨ <code>NewEvent</code> å†…éƒ¨æ¨¡æ‹Ÿäº†åˆ›å»º <code>Event</code> å‡ºé”™çš„åœºæ™¯ï¼Œå¹¶å°†é”™è¯¯è¿”å›ã€‚</p>
<p>ç°åœ¨ <code>InitializeEvent</code> å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">(phrase <span class="keyword">string</span>)</span> <span class="params">(Event, error)</span></span> &#123;</span><br><span class="line">	wire.Build(NewEvent, NewMessage, NewGreeter)</span><br><span class="line">	<span class="keyword">return</span> Event&#123;&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡ä¼ ç»™ <code>wire.Build</code> çš„ 3 ä¸ªæ„é€ å‡½æ•°é¡ºåºä¸åŒï¼Œå¯è§é¡ºåºå¹¶ä¸é‡è¦ã€‚ä½†ä¸ºäº†ä»£ç å¯ç»´æŠ¤æ€§ï¼Œæˆ‘å»ºè®®è¿˜æ˜¯è¦æŒ‰ç…§ä¾èµ–é¡ºåºä¾æ¬¡ä¼ å…¥ <code>provider</code>ã€‚</p>
<p>è¿™é‡Œè¿”å›å€¼å¢åŠ äº† <code>error</code>ï¼Œæ‰€ä»¥ <code>return</code> çš„å€¼å¢åŠ äº†ä¸€ä¸ª <code>nil</code>ï¼Œå…¶å®æˆ‘ä»¬è¿”å›ä»€ä¹ˆå¹¶ä¸é‡è¦ï¼Œåªè¦è¿”å›çš„ç±»å‹æ­£ç¡®å³å¯ï¼ˆç¡®ä¿ç¼–è¯‘é€šè¿‡ï¼‰ï¼Œå› ä¸ºæœ€ç»ˆç”Ÿæˆçš„ä»£ç è¿”å›å€¼æ˜¯ç”± <code>wire</code> ç”Ÿæˆçš„ã€‚</p>
<blockquote>
<p>NOTE: ä¸ºäº†é€»è¾‘æ¸…æ™°ï¼Œæˆ‘åªè´´å‡ºæ ¸å¿ƒä»£ç ï¼Œå¹¶ä¸” <code>wire.go</code> æ–‡ä»¶ä¹Ÿä¸å†è´´å‡º <code>//go:build wireinject</code> ç›¸å…³ä»£ç ï¼Œåæ–‡ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä½ åœ¨å®è·µæ—¶ä¸è¦å¿˜è®°ã€‚å®Œæ•´ä»£ç è¯¦è§æ–‡æœ«ç»™å‡ºçš„ <a href="https://github.com/jianghushinian/blog-go-example/tree/main/wire" target="_blank" rel="noopener">GitHub åœ°å€</a>ã€‚</p>
</blockquote>
<p>ä½¿ç”¨ <code>wire</code> ç”Ÿæˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">(phrase <span class="keyword">string</span>)</span> <span class="params">(Event, error)</span></span> &#123;</span><br><span class="line">	message := NewMessage(phrase)</span><br><span class="line">	greeter := NewGreeter(message)</span><br><span class="line">	event, err := NewEvent(greeter)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Event&#123;&#125;, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> event, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬æ‰§è¡Œç¤ºä¾‹ä»£ç ï¼Œå¯èƒ½å‡ºç°ä¸¤ç§æƒ…å†µï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run .    </span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run .      </span><br><span class="line">new event error</span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨-ProviderSet-è¿›è¡Œåˆ†ç»„"><a href="#ä½¿ç”¨-ProviderSet-è¿›è¡Œåˆ†ç»„" class="headerlink" title="ä½¿ç”¨ ProviderSet è¿›è¡Œåˆ†ç»„"></a>ä½¿ç”¨ ProviderSet è¿›è¡Œåˆ†ç»„</h4><p>wire ä¸ºæˆ‘ä»¬æä¾›äº† <code>provider sets</code>ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒå¯ä»¥åŒ…å«ä¸€ç»„ <code>providers</code>ã€‚ä½¿ç”¨ <code>wire.NewSet</code> å‡½æ•°å¯ä»¥å°†å¤šä¸ª <code>provider</code> æ·»åŠ åˆ°ä¸€ä¸ªé›†åˆä¸­ã€‚</p>
<p>æˆ‘ä»¬æŠŠ <code>NewMessage</code>ã€<code>NewGreeter</code> ä¸¤ä¸ªæ„é€ å‡½æ•°åˆå¹¶æˆä¸€ä¸ª <code>provider sets</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> providerSet wire.ProviderSet = wire.NewSet(NewMessage, NewGreeter)</span><br></pre></td></tr></table></figure>

<p><code>wire.NewSet</code> æ¥æ”¶ä¸å®šé•¿å‚æ•°ï¼Œå¹¶å°†å®ƒä»¬ç»„è£…æˆä¸€ä¸ª <code>wire.ProviderSet</code> ç±»å‹è¿”å›ã€‚</p>
<p><code>wire.Build</code> å¯ä»¥ç›´æ¥æ¥æ”¶ <code>wire.ProviderSet</code> ç±»å‹ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦ç»™å®ƒä¼ é€’ä¸¤ä¸ªå‚æ•°å³å¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">(phrase <span class="keyword">string</span>)</span> <span class="params">(Event, error)</span></span> &#123;</span><br><span class="line">	wire.Build(NewEvent, providerSet)</span><br><span class="line">	<span class="keyword">return</span> Event&#123;&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>wire</code> ç”Ÿæˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">(phrase <span class="keyword">string</span>)</span> <span class="params">(Event, error)</span></span> &#123;</span><br><span class="line">	message := NewMessage(phrase)</span><br><span class="line">	greeter := NewGreeter(message)</span><br><span class="line">	event, err := NewEvent(greeter)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Event&#123;&#125;, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> event, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ä¹‹å‰ç”Ÿæˆçš„ä»£ç ä¸€æ¨¡ä¸€æ ·ã€‚</p>
<p>åˆ†ç»„åï¼Œä»£ç ä¼šæ›´åŠ æ¸…æ™°ï¼Œæ¯ä¸ª <code>provider sets</code> ä»…åŒ…å«ä¸€ç»„å…³è”çš„ <code>providers</code>ï¼Œä¸‹æ–‡ä¸­å®è·µéƒ¨åˆ†ä½ è¿˜èƒ½å¤Ÿçœ‹åˆ° <code>provider sets</code> æ›´å…·æœ‰æ„ä¹‰çš„ç”¨æ³•ã€‚</p>
<h4 id="ä½¿ç”¨-Struct-å®šåˆ¶-Provider"><a href="#ä½¿ç”¨-Struct-å®šåˆ¶-Provider" class="headerlink" title="ä½¿ç”¨ Struct å®šåˆ¶ Provider"></a>ä½¿ç”¨ Struct å®šåˆ¶ Provider</h4><p>æœ‰æ—¶å€™ä¸€ä¸ª <code>struct</code> æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬é€šå¸¸ä¸ä¼šä¸ºå…¶å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>wire.Struct</code> ä½œä¸º <code>provider</code>ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤ºæ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¿®æ”¹ <code>Message</code> å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Message <span class="keyword">struct</span> &#123;</span><br><span class="line">	Content <span class="keyword">string</span></span><br><span class="line">	Code    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ <code>InitializeEvent</code> ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">(phrase <span class="keyword">string</span>, code <span class="keyword">int</span>)</span> <span class="params">(Event, error)</span></span> &#123;</span><br><span class="line">	wire.Build(NewEvent, NewGreeter, wire.Struct(<span class="built_in">new</span>(Message), <span class="string">"Content"</span>))</span><br><span class="line">	<span class="keyword">return</span> Event&#123;&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä½¿ç”¨ <code>wire.Struct(new(Message), &quot;Content&quot;)</code> æ›¿ä»£äº†åŸæ¥çš„ <code>NewMessage</code> ä½œä¸ºä¸€ä¸ª <code>provider</code>ã€‚</p>
<p><code>wire.Struct</code> å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Struct</span><span class="params">(structType <span class="keyword">interface</span>&#123;&#125;, fieldNames ...<span class="keyword">string</span>)</span> <span class="title">StructProvider</span></span></span><br></pre></td></tr></table></figure>

<p><code>structType</code> å°±æ˜¯æˆ‘ä»¬è¦ä½¿ç”¨çš„ <code>struct</code>ï¼Œ<code>fieldNames</code> ç”¨æ¥æ§åˆ¶å“ªäº›å­—æ®µä¼šè¢«èµ‹å€¼ã€‚</p>
<p>æ­£å¸¸æ¥è¯´ <code>InitializeEvent</code> çš„ <code>phrase</code> å‚æ•°ä¼šä¼ ç»™ <code>Message</code> çš„ <code>Content</code> å­—æ®µï¼Œ<code>code</code> å‚æ•°ä¼šä¼ ç»™ <code>Code</code>ã€‚wire æ ¹æ®<strong>å‚æ•°ç±»å‹</strong>æ¥åˆ¤æ–­åº”è¯¥å°†å‚æ•°ä¼ ç»™è°ã€‚</p>
<p>ç”±äºæˆ‘ä»¬åœ¨è¿™é‡Œä»…æ˜¾å¼æŒ‡å®šäº† <code>Content</code> å­—æ®µï¼Œæ‰€ä»¥æœ€ç»ˆåªæœ‰ <code>Content</code> å­—æ®µä¼šè¢«èµ‹å€¼ã€‚</p>
<p>ä½¿ç”¨ <code>wire</code> ç”Ÿæˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">(phrase <span class="keyword">string</span>, code <span class="keyword">int</span>)</span> <span class="params">(Event, error)</span></span> &#123;</span><br><span class="line">	message := Message&#123;</span><br><span class="line">		Content: phrase,</span><br><span class="line">	&#125;</span><br><span class="line">	greeter := NewGreeter(message)</span><br><span class="line">	event, err := NewEvent(greeter)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Event&#123;&#125;, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> event, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ç”Ÿæˆçš„ä»£ç å¯ä»¥å‘ç°ï¼Œç¡®å®æ²¡ç»™ <code>Code</code> èµ‹å€¼ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³ç»™ <code>Code</code> èµ‹å€¼ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wire.Build(NewEvent, NewGreeter, wire.Struct(<span class="built_in">new</span>(Message), <span class="string">"Content"</span>, <span class="string">"Code"</span>))</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wire.Build(NewEvent, NewGreeter, wire.Struct(<span class="built_in">new</span>(Message), <span class="string">"*"</span>))</span><br></pre></td></tr></table></figure>

<p><code>*</code> è¡¨ç¤ºé€šé…ç¬¦ï¼Œå³ä½¿ç”¨ <code>Message</code> æ‰€æœ‰å­—æ®µã€‚</p>
<p>ä½¿ç”¨ <code>wire.Struct</code> çš„å¥½å¤„æ˜¯å°‘å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥å®šåˆ¶ä½¿ç”¨å­—æ®µã€‚</p>
<h4 id="ä½¿ç”¨-Struct-å­—æ®µä½œä¸º-Provider"><a href="#ä½¿ç”¨-Struct-å­—æ®µä½œä¸º-Provider" class="headerlink" title="ä½¿ç”¨ Struct å­—æ®µä½œä¸º Provider"></a>ä½¿ç”¨ Struct å­—æ®µä½œä¸º Provider</h4><p>æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®š <code>struct</code> çš„å…·ä½“æŸä¸ªå­—æ®µä½œä¸ºä¸€ä¸ª <code>provider</code>ã€‚</p>
<p>è¿™éœ€è¦ç”¨åˆ° <code>wire.FieldsOf</code>ï¼Œå‡½æ•°ç­¾åå¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FieldsOf</span><span class="params">(structType <span class="keyword">interface</span>&#123;&#125;, fieldNames ...<span class="keyword">string</span>)</span> <span class="title">StructFields</span></span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°å®ƒè·Ÿ <code>wire.Struct</code> å‡½æ•°å‚æ•°ä¸€æ ·ï¼ŒåŒºåˆ«æ˜¯è¿”å›å€¼ä¸åŒã€‚</p>
<p>ç°åœ¨ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Content <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Message <span class="keyword">struct</span> &#123;</span><br><span class="line">	Content Content</span><br><span class="line">	Code    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewMessage æ³¨æ„ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯æŒ‡é’ˆç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMessage</span><span class="params">(content <span class="keyword">string</span>, code <span class="keyword">int</span>)</span> *<span class="title">Message</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Message&#123;</span><br><span class="line">		Content: Content(content),</span><br><span class="line">		Code:    code,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Message</code> çš„ <code>Content</code> å­—æ®µä¿®æ”¹ä¸º <code>string</code> çš„åˆ«åç±»å‹ <code>Content</code>ï¼Œ<strong>è¿™æ˜¯æœ‰ç”¨æ„çš„ï¼Œç¨åè®²è§£</strong>ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤ºæ›´å¤šç§æƒ…å†µï¼Œè¿™é‡Œé‡‡ç”¨æ—¥å¸¸å¼€å‘ä¸­æ›´åŠ å¸¸ç”¨çš„åœºæ™¯ï¼Œå³æ„é€ å‡½æ•°è¿”å› <code>struct</code> çš„æŒ‡é’ˆç±»å‹ã€‚</p>
<p>ä¿®æ”¹ <code>InitializeEvent</code> ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeMessage</span><span class="params">(phrase <span class="keyword">string</span>, code <span class="keyword">int</span>)</span> <span class="title">Content</span></span> &#123;</span><br><span class="line">	wire.Build(NewMessage, wire.FieldsOf(<span class="built_in">new</span>(*Message), <span class="string">"Content"</span>))</span><br><span class="line">	<span class="keyword">return</span> Content(<span class="string">""</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºç¤ºä¾‹ä»£ç ä¸­ <code>NewMessage</code> è¿”å› <code>*Message</code> ç±»å‹ï¼Œè€Œé <code>Message</code> ç±»å‹ï¼Œæ‰€ä»¥ä¼ é€’ç»™ <code>wire.FieldsOf</code> å¿…é¡»æ˜¯ <code>new(*Message)</code> è€Œä¸æ˜¯ <code>new(Message)</code>ã€‚</p>
<p><code>InitializeMessage</code> å‡½æ•°è¿”å› <code>Content</code> ç±»å‹ï¼Œè€Œé <code>Message</code> ç±»å‹ã€‚</p>
<p>ä½¿ç”¨ <code>wire</code> ç”Ÿæˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeMessage</span><span class="params">(phrase <span class="keyword">string</span>, code <span class="keyword">int</span>)</span> <span class="title">Content</span></span> &#123;</span><br><span class="line">	message := NewMessage(phrase, code)</span><br><span class="line">	content := message.Content</span><br><span class="line">	<span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ç”Ÿæˆçš„ä»£ç å¯ä»¥å‘ç°ï¼Œåœ¨é€šè¿‡ <code>NewMessage</code> å‡½æ•°åˆ›å»º <code>*Message</code> å¯¹è±¡ä»¥åï¼Œä¼šå°† <code>message.Content</code> å­—æ®µæå–å‡ºæ¥å¹¶è¿”å›ã€‚</p>
<p>å‰æ–‡åœ¨è®²è§£ <a href="#ä½¿ç”¨-Struct-å­—æ®µä½œä¸º-Provider">ä½¿ç”¨ Struct å®šåˆ¶ Provider</a>æ—¶æˆ‘æåˆ°è¿‡ã€Œwire æ ¹æ®<strong>å‚æ•°ç±»å‹</strong>æ¥åˆ¤æ–­åº”è¯¥å°†å‚æ•°ä¼ ç»™è°ã€ã€‚</p>
<p>å…¶å®ä¸ä»…ä»…æ˜¯å‚æ•°ï¼Œwire è§„å®š <code>injector</code> å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹éƒ½å¿…é¡»å”¯ä¸€ã€‚ä¸ç„¶ wire æ— æ³•å¯¹åº”ä¸Šå“ªä¸ªå€¼è¯¥ç»™è°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¸“é—¨å®šä¹‰äº† <code>Content</code> ç±»å‹ä½œä¸º <code>Message</code> çš„å­—æ®µï¼Œå› ä¸º <code>InitializeMessage</code> çš„å‚æ•° <code>phrase</code> å·²ç»æ˜¯ <code>string</code> ç±»å‹äº†ï¼Œæ‰€ä»¥å…¶è¿”å›å€¼å°±ä¸èƒ½æ˜¯ <code>string</code> ç±»å‹äº†ã€‚</p>
<p>ç°åœ¨å°±æ¥æ¼”ç¤ºä¸€ä¸‹ <code>injector</code> å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹å‡ºç°é‡å¤çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æŠŠ <code>Message</code> æ”¹å›å»ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Message <span class="keyword">struct</span> &#123;</span><br><span class="line">	Content <span class="keyword">string</span></span><br><span class="line">	Code    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewMessage æ³¨æ„ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯æŒ‡é’ˆç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMessage</span><span class="params">(content <span class="keyword">string</span>, code <span class="keyword">int</span>)</span> *<span class="title">Message</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Message&#123;</span><br><span class="line">		Content: content,</span><br><span class="line">		Code:    code,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>InitializeEvent</code> å‡½æ•°è¿”å›å€¼ä¹Ÿæ”¹ä¸º <code>string</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeMessage</span><span class="params">(phrase <span class="keyword">string</span>, code <span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	wire.Build(NewMessage, wire.FieldsOf(<span class="built_in">new</span>(*Message), <span class="string">"Content"</span>))</span><br><span class="line">	<span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä½¿ç”¨ <code>wire</code> ç”Ÿæˆä»£ç ï¼Œä¼šå¾—åˆ°ç±»ä¼¼å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ wire gen .</span><br><span class="line">wire: wire.go:10:2: multiple bindings <span class="keyword">for</span> string</span><br><span class="line">        current:</span><br><span class="line">        &lt;- wire.FieldsOf (structfields.go:8:2)</span><br><span class="line">        previous:</span><br><span class="line">        &lt;- argument phrase to injector <span class="keyword">function</span> InitializeMessage (wire.go:7:1)</span><br><span class="line">wire: github.com/jianghushinian/blog-go-example/wire/getting-started/advanced/structfields: generate failed</span><br><span class="line">wire: at least one generate failure</span><br></pre></td></tr></table></figure>

<blockquote>
<p>NOTE: æ³¨æ„ï¼Œè¿™é‡Œä¸ºäº†å±•ç¤ºæ¸…æ™°ï¼Œæˆ‘å°†è¾“å‡ºçš„æ–‡ä»¶ç»å¯¹è·¯å¾„è¿›è¡Œäº†ä¿®æ”¹ï¼Œå»æ‰äº†è·¯å¾„éƒ¨åˆ†ï¼Œåªä¿ç•™äº†æ–‡ä»¶åï¼Œä¸å½±å“è¾“å‡ºè¯­ä¹‰ã€‚åæ–‡ä¸­å¯èƒ½ä¹Ÿä¼šå¦‚æ­¤ã€‚</p>
</blockquote>
<p>æ ¹æ®é”™è¯¯ä¿¡æ¯ <code>multiple bindings for string</code> å¯çŸ¥ï¼Œwire ä¸æ”¯æŒå‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹å‡ºç°é‡å¤ã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“é‡åˆ° <code>injector</code> å‡½æ•°å‡ºç°å‚æ•°æˆ–è¿”å›å€¼ç±»å‹é‡å¤çš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ç»™ç±»å‹å®šä¹‰åˆ«åæ¥è§£å†³ã€‚</p>
<h4 id="ç»‘å®šã€Œå€¼ã€ä½œä¸º-Provider"><a href="#ç»‘å®šã€Œå€¼ã€ä½œä¸º-Provider" class="headerlink" title="ç»‘å®šã€Œå€¼ã€ä½œä¸º Provider"></a>ç»‘å®šã€Œå€¼ã€ä½œä¸º Provider</h4><p>å¯ä»¥ç›´æ¥å°†ä¸€ä¸ª<strong>å€¼</strong>ä½œä¸ºå‚æ•°ä¼ ç»™ <code>wire.Value</code> æ¥æ„é€ ä¸€ä¸ª <code>provider</code>ã€‚</p>
<p>å®šä¹‰ <code>Message</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Message <span class="keyword">struct</span> &#123;</span><br><span class="line">	Message <span class="keyword">string</span></span><br><span class="line">	Code    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥å®ä¾‹åŒ–è¿™ä¸ª <code>struct</code>ï¼Œç„¶åå°†å…¶ä¼ ç»™ <code>wire.Value</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeMessage</span><span class="params">()</span> <span class="title">Message</span></span> &#123;</span><br><span class="line">	<span class="comment">// å‡è®¾æ²¡æœ‰æä¾› NewMessageï¼Œå¯ä»¥ç›´æ¥ç»‘å®šå€¼å¹¶è¿”å›</span></span><br><span class="line">	wire.Build(wire.Value(Message&#123;</span><br><span class="line">		Message: <span class="string">"Binding Values"</span>,</span><br><span class="line">		Code:    <span class="number">1</span>,</span><br><span class="line">	&#125;))</span><br><span class="line">	<span class="keyword">return</span> Message&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>wire</code> ç”Ÿæˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeMessage</span><span class="params">()</span> <span class="title">Message</span></span> &#123;</span><br><span class="line">	message := _wireMessageValue</span><br><span class="line">	<span class="keyword">return</span> message</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	_wireMessageValue = Message&#123;</span><br><span class="line">		Message: <span class="string">"Binding Values"</span>,</span><br><span class="line">		Code:    <span class="number">1</span>,</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°ï¼Œå®é™…ä¸Š wire ä¸ºæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œå¹¶å°†è¿™ä¸ªå˜é‡ä½œä¸º <code>InitializeMessage</code> å‡½æ•°è¿”å›å€¼ã€‚</p>
<p>è¿™ç§æ‹¿æ¥å³ç”¨çš„æ–¹å¼ï¼Œæä¾›äº†éå¸¸å¤§çš„ä¾¿åˆ©ã€‚</p>
<p><code>wire.Value</code> æ¥æ”¶ä»»ä½•<strong>å€¼ç±»å‹</strong>ï¼Œæ‰€ä»¥ä¸æ­¢ <code>struct</code>ï¼Œä¸€ä¸ªæ™®é€šçš„ <code>int</code>ã€<code>string</code> ç­‰ç±»å‹éƒ½å¯ä»¥ï¼Œå°±äº¤ç»™ä½ è‡ªå·±å»å°è¯•äº†ã€‚</p>
<h4 id="ç»‘å®šã€Œæ¥å£ã€ä½œä¸º-Provider"><a href="#ç»‘å®šã€Œæ¥å£ã€ä½œä¸º-Provider" class="headerlink" title="ç»‘å®šã€Œæ¥å£ã€ä½œä¸º Provider"></a>ç»‘å®šã€Œæ¥å£ã€ä½œä¸º Provider</h4><p><code>provider</code> ä¾èµ–é¡¹æˆ–è¿”å›å€¼å¹¶ä¸æ€»æ˜¯<strong>å€¼</strong>ï¼Œå¾ˆå¤šæ—¶å€™æ˜¯ä¸€ä¸ª<strong>æ¥å£</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ¥å°†ä¸€ä¸ª<strong>æ¥å£</strong>ä½œä¸ºå‚æ•°ä¼ ç»™ <code>wire.InterfaceValue</code> æ¥æ„é€ ä¸€ä¸ª <code>provider</code>ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ª <code>Write</code> å‡½æ•°ï¼Œå®ƒä¾èµ–ä¸€ä¸ª <code>io.Writer</code> æ¥å£ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Write</span><span class="params">(w io.Writer, value any)</span></span> &#123;</span><br><span class="line">	n, err := fmt.Fprintln(w, value)</span><br><span class="line">	fmt.Printf(<span class="string">"n: %d, err: %v\n"</span>, n, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒ <code>wire.Value</code> ç”¨æ³•ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>wire.InterfaceValue</code> ç»‘å®šæ¥å£ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeWriter</span><span class="params">()</span> <span class="title">io</span>.<span class="title">Writer</span></span> &#123;</span><br><span class="line">	wire.Build(wire.InterfaceValue(<span class="built_in">new</span>(io.Writer), os.Stdout))</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>wire</code> ç”Ÿæˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeWriter</span><span class="params">()</span> <span class="title">io</span>.<span class="title">Writer</span></span> &#123;</span><br><span class="line">	writer := _wireFileValue</span><br><span class="line">	<span class="keyword">return</span> writer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	_wireFileValue = os.Stdout</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆä»£ç å¥—è·¯è·Ÿ <code>wire.Value</code> æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<h4 id="ç»‘å®šç»“æ„ä½“åˆ°æ¥å£"><a href="#ç»‘å®šç»“æ„ä½“åˆ°æ¥å£" class="headerlink" title="ç»‘å®šç»“æ„ä½“åˆ°æ¥å£"></a>ç»‘å®šç»“æ„ä½“åˆ°æ¥å£</h4><p>æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šå†™å‡ºå¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Message <span class="keyword">struct</span> &#123;</span><br><span class="line">	Content <span class="keyword">string</span></span><br><span class="line">	Code    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Store <span class="keyword">interface</span> &#123;</span><br><span class="line">	Save(msg *Message) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> store <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¡®ä¿ store å®ç°äº† Store æ¥å£</span></span><br><span class="line"><span class="keyword">var</span> _ Store = (*store)(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span> *<span class="title">store</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;store&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *store)</span> <span class="title">Save</span><span class="params">(msg *Message)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SaveMessage</span><span class="params">(s Store, msg *Message)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"save message: %+v\n"</span>, msg)</span><br><span class="line">	<span class="keyword">return</span> s.Save(msg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RunStore</span><span class="params">(msg *Message)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	s := New()</span><br><span class="line">	<span class="keyword">return</span> SaveMessage(s, msg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Store</code> æ¥å£å®šä¹‰äº†ä¸€ä¸ª <code>Save</code> æ–¹æ³•ç”¨æ¥ä¿å­˜ <code>Message</code>ï¼Œå®šä¹‰äº† <code>store</code> ç»“æ„ä½“ï¼Œç»“æ„ä½“çš„æŒ‡é’ˆ <code>*store</code> å®ç°äº† <code>Store</code> æ¥å£ï¼Œæ‰€ä»¥ <code>store</code> çš„æ„é€ å‡½æ•° <code>New</code> è¿”å› <code>*store</code>ã€‚</p>
<p>æˆ‘ä»¬è¿˜å®šä¹‰äº† <code>SaveMessage</code> æ–¹æ³•ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ <code>Store</code> æ¥å£ä»¥åŠ <code>*Message</code>ã€‚</p>
<p>æœ€ç»ˆå®šä¹‰çš„ <code>RunStore</code> æ–¹æ³•æ¥æ”¶ <code>*Message</code>ï¼Œå¹¶åœ¨å†…éƒ¨åˆ›å»º <code>*store</code>ï¼Œç„¶åå°†è¿™ä¸¤ä¸ªå˜é‡ä¼ ç»™ <code>SaveMessage</code> ä¿å­˜æ¶ˆæ¯ã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬æƒ³ä½¿ç”¨ <code>wire</code> å‘½ä»¤æ¥ç”Ÿæˆ <code>RunStore</code> å‡½æ•°ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WireRunStore</span><span class="params">(msg *Message)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	wire.Build(SaveMessage, New)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>wire</code> ç”Ÿæˆä»£ç å°†å¾—åˆ°æŠ¥é”™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wire gen .</span><br><span class="line">wire: wire.go:7:1: inject WireRunStore: no provider found <span class="keyword">for</span> github.com/jianghushinian/blog-go-example/wire/getting-started/advanced/bindingstruct.Store</span><br><span class="line">        needed by error <span class="keyword">in</span> provider <span class="string">"SaveMessage"</span> (bindingstruct.go:29:6)</span><br><span class="line">wire: github.com/jianghushinian/blog-go-example/wire/getting-started/advanced/bindingstruct: generate failed</span><br><span class="line">wire: at least one generate failure</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸º <strong>wire çš„æ„å»ºä¾é å‚æ•°ç±»å‹ï¼Œä½†ä¸æ”¯æŒæ¥å£ç±»å‹</strong>ã€‚è€Œ <code>SaveMessage</code> çš„ <code>s Store</code> å‚æ•°å°±æ˜¯æ¥å£ã€‚</p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>wire.Bind</code> å‘Šè¯‰ <code>wire</code> å·¥å…·ï¼Œå°†ä¸€ä¸ªç»“æ„ä½“ç»‘å®šåˆ°æ¥å£ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WireRunStore</span><span class="params">(msg *Message)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="comment">// new(Store) æ¥å£æ— éœ€ä½¿ç”¨æŒ‡é’ˆ</span></span><br><span class="line">	wire.Build(SaveMessage, New, wire.Bind(<span class="built_in">new</span>(Store), <span class="built_in">new</span>(*store)))</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œ<code>wire</code> å°±çŸ¥é“ <code>New</code> åˆ›å»ºå¾—åˆ°çš„ <code>*store</code> ç±»å‹éœ€è¦ä¼ é€’ç»™ <code>SaveMessage</code> çš„ <code>s Store</code> å‚æ•°äº†ã€‚</p>
<p>ä½¿ç”¨ <code>wire</code> ç”Ÿæˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WireRunStore</span><span class="params">(msg *Message)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	bindingstructStore := New()</span><br><span class="line">	error2 := SaveMessage(bindingstructStore, msg)</span><br><span class="line">	<span class="keyword">return</span> error2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰é—®é¢˜ã€‚</p>
<h4 id="æ¸…ç†å‡½æ•°"><a href="#æ¸…ç†å‡½æ•°" class="headerlink" title="æ¸…ç†å‡½æ•°"></a>æ¸…ç†å‡½æ•°</h4><p>æœ‰æ—¶å€™æˆ‘ä»¬çš„å‡½æ•°è¿”å›å€¼å¯èƒ½åŒ…å«ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œç”¨æ¥é‡Šæ”¾èµ„æºï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">OpenFile</span><span class="params">(path <span class="keyword">string</span>)</span> <span class="params">(*os.File, <span class="keyword">func</span>()</span>, <span class="title">error</span>)</span> &#123;</span><br><span class="line">	f, err := os.Open(path)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cleanup := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"cleanup..."</span>)</span><br><span class="line">		<span class="keyword">if</span> err := f.Close(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> f, cleanup, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadFile</span><span class="params">(f *os.File)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">	b := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">1024</span>)</span><br><span class="line">	_, err := f.Read(b)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">""</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">string</span>(b), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>OpenFile</code> å‡½æ•°æ¥æ”¶ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä½œä¸ºå‚æ•°ï¼Œå…¶å†…éƒ¨ä¼šæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶è¿”å›æ–‡ä»¶å¯¹è±¡ <code>*os.File</code>ã€‚é™¤æ­¤ä»¥å¤–ï¼Œè¿˜ä¼šè¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°å’Œ <code>error</code>ï¼Œæ¸…ç†å‡½æ•°å†…éƒ¨ä¼šè°ƒç”¨ <code>f.Close()</code> å…³é—­æ–‡ä»¶å¯¹è±¡ã€‚</p>
<p><code>ReadFile</code> å‡½æ•°ä¾èµ– <code>*os.File</code> æ–‡ä»¶å¯¹è±¡ï¼Œå¯ä»¥è¯»å–å¹¶è¿”å›å…¶å†…å®¹ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å®šä¹‰å¦‚ä¸‹ <code>injector</code> å‡½æ•°ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeFile</span><span class="params">(path <span class="keyword">string</span>)</span> <span class="params">(*os.File, <span class="keyword">func</span>()</span>, <span class="title">error</span>)</span> &#123;</span><br><span class="line">	wire.Build(OpenFile)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>wire</code> ç”Ÿæˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeFile</span><span class="params">(path <span class="keyword">string</span>)</span> <span class="params">(*os.File, <span class="keyword">func</span>()</span>, <span class="title">error</span>)</span> &#123;</span><br><span class="line">	file, cleanup, err := OpenFile(path)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> file, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		cleanup()</span><br><span class="line">	&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°ï¼Œwire èƒ½å¤Ÿæ­£ç¡®å¤„ç†è¿™ç§æƒ…å†µã€‚</p>
<p>ä¸è¿‡ï¼Œwire è§„å®šæ¸…ç†å‡½æ•°ç­¾ååªèƒ½ä¸º <code>func()</code>ã€‚è€Œ <code>InitializeFile</code> å‡½æ•°çš„è¿”å›å€¼ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å·¥ä½œä¸­ä½¿ç”¨ wire çš„å…¸å‹åœºæ™¯ï¼š<code>injector</code> å‡½æ•°è¿”å› 3 ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯å¯¹è±¡ã€æ¸…ç†å‡½æ•°ä»¥åŠ <code>error</code>ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">f, cleanup, err := InitializeFile(<span class="string">"testdata/multi.txt"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">content, err := ReadFile(f)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(content)</span><br><span class="line">cleanup()</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå‡å¦‚æˆ‘ä»¬ä¼ é€’ç»™çš„ <code>wire.Build</code> å¤šä¸ª <code>provider</code> éƒ½å­˜åœ¨æ¸…ç†å‡½æ•°ï¼Œè¿™æ—¶å€™ <code>wire</code> å‘½åç”Ÿæˆçš„ä»£ç ä¼šæ˜¯ä»€ä¹ˆæ ·å‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªå°±å½“åšä½œä¸šç•™ç»™ä½ è‡ªå·±å»å°è¯•äº†ã€‚</p>
<blockquote>
<p>NOTE: å¦‚æœä½ æ‡’å¾—å°è¯•ğŸ¤£ï¼Œå…¶å®æˆ‘ä¹Ÿå†™å¥½äº†ä¾‹å­ï¼Œä½ å¯ä»¥ç‚¹å‡» <a href="https://github.com/jianghushinian/blog-go-example/tree/main/wire/getting-started/advanced/cleanupfunctions/multi" target="_blank" rel="noopener">GitHub åœ°å€</a>è¿›è¡ŒæŸ¥çœ‹ã€‚ç¯‡å¹…æ‰€é™ï¼Œæˆ‘å°±ä¸è´´ä»£ç äº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥ç‚¹è¿›å»æŸ¥çœ‹ã€‚</p>
</blockquote>
<h4 id="å¤‡ç”¨æ³¨å…¥å™¨è¯­æ³•ï¼Œç»™è¯­æ³•åŠ ç‚¹ç³–"><a href="#å¤‡ç”¨æ³¨å…¥å™¨è¯­æ³•ï¼Œç»™è¯­æ³•åŠ ç‚¹ç³–" class="headerlink" title="å¤‡ç”¨æ³¨å…¥å™¨è¯­æ³•ï¼Œç»™è¯­æ³•åŠ ç‚¹ç³–"></a>å¤‡ç”¨æ³¨å…¥å™¨è¯­æ³•ï¼Œç»™è¯­æ³•åŠ ç‚¹ç³–</h4><p>å‰æ–‡è®²è¿‡ï¼Œ<code>injector</code> å‡½æ•°è¿”å›å€¼å¹¶ä¸é‡è¦ï¼Œåªè¦æˆ‘ä»¬å†™åœ¨ <code>return</code> åé¢çš„è¿”å›å€¼ç±»å‹ï¼Œè·Ÿå‡½æ•°ç­¾åä¸€è‡´å³å¯ã€‚å› ä¸º wire ä¼šå¿½ç•¥å®ƒä»¬ï¼Œæ‰€ä»¥ä¸Šé¢å¾ˆå¤šç¤ºä¾‹è¿”å›å€¼æˆ‘éƒ½ä½¿ç”¨ <code>nil</code> æ¥æ›¿ä»£ã€‚</p>
<p>é‚£ä¹ˆï¼Œæ—¢ç„¶è¿”å›å€¼æ²¡ä»€ä¹ˆç”¨ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥å·ä¸ªæ‡’ï¼Œä¸å†™ <code>return</code> å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ <code>panic</code>ï¼Œè¿™æ ·ç¨‹åºä¾ç„¶å¯ä»¥é€šè¿‡ç¼–è¯‘ã€‚</p>
<p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Message <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMessage</span><span class="params">(phrase <span class="keyword">string</span>)</span> <span class="title">Message</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Message(phrase)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç›´æ¥åœ¨ <code>injector</code> å‡½æ•°ä¸­ä½¿ç”¨ <code>panic</code> æ¥ç®€åŒ–ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeMessage</span><span class="params">(phrase <span class="keyword">string</span>)</span> <span class="title">Message</span></span> &#123;</span><br><span class="line">	<span class="built_in">panic</span>(wire.Build(NewMessage))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>wire</code> ç”Ÿæˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeMessage</span><span class="params">(phrase <span class="keyword">string</span>)</span> <span class="title">Message</span></span> &#123;</span><br><span class="line">	message := NewMessage(phrase)</span><br><span class="line">	<span class="keyword">return</span> message</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</p>
<p>è¿™ç§æ–¹å¼å°‘å†™äº†ä¸€è¡Œ <code>return</code>ï¼Œç®—æ˜¯ wire ç»™æˆ‘ä»¬æä¾›çš„ä¸€ä¸ªâ€œè¯­æ³•ç³–â€ã€‚Kratos æ¡†æ¶<a href="https://go-kratos.dev/docs/guide/wire/" target="_blank" rel="noopener">æ–‡æ¡£</a>ä¸­ä¹Ÿæ˜¯è¿™ä¹ˆå†™çš„ï¼Œä½ å¯ä»¥ç‚¹å‡»æŸ¥çœ‹ã€‚</p>
<p>è‡³äºåˆ°åº•é€‰ç”¨ <code>return</code> è¿˜æ˜¯ <code>panic</code>ï¼Œç¤¾åŒºå¹¶æ²¡æœ‰ä¸€è‡´çš„è§„èŒƒï¼Œçœ‹ä¸ªäººå–œå¥½å°±å¥½ã€‚æˆ‘ç›®å‰æ›´å–œæ¬¢ä½¿ç”¨ <code>return</code>ï¼Œæ¯•ç«Ÿè°éƒ½ä¸å¸Œæœ›è‡ªå·±ç¨‹åºå‡ºç° <code>panic</code>ï¼Œå ä½ä¹Ÿä¸è¡Œ :)ã€‚</p>
<p>è‡³æ­¤ï¼Œç»ˆäºå°† wire çš„å¸¸ç”¨åŠŸèƒ½å…¨éƒ¨è®²è§£å®Œæ¯•ï¼Œæ¥ä¸‹æ¥å°±è¿›å…¥ wire ç”Ÿäº§å®è·µäº†ã€‚</p>
<h3 id="Wire-ç”Ÿäº§å®è·µ"><a href="#Wire-ç”Ÿäº§å®è·µ" class="headerlink" title="Wire ç”Ÿäº§å®è·µ"></a>Wire ç”Ÿäº§å®è·µ</h3><p>è¿™é‡Œä»¥ä¸€ä¸ª <code>user</code> æœåŠ¡ä½œä¸ºç¤ºä¾‹ï¼Œæ¼”ç¤ºä¸‹ä¸€ä¸ªç”Ÿäº§é¡¹ç›®ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·çš„ã€‚</p>
<p><code>user</code> é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ tree user</span><br><span class="line">user</span><br><span class="line">â”œâ”€â”€ assets</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ curl.sh</span><br><span class="line">â”‚Â Â  â””â”€â”€ schema.sql</span><br><span class="line">â”œâ”€â”€ cmd</span><br><span class="line">â”‚Â Â  â””â”€â”€ main.go</span><br><span class="line">â”œâ”€â”€ go.mod</span><br><span class="line">â”œâ”€â”€ go.sum</span><br><span class="line">â”œâ”€â”€ internal</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ biz</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ user.go</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ config</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ config.go</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ controller</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ user.go</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ model</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ user.go</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ router.go</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ store</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ user.go</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ user.go</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ wire.go</span><br><span class="line">â”‚Â Â  â””â”€â”€ wire_gen.go</span><br><span class="line">â””â”€â”€ pkg</span><br><span class="line">    â”œâ”€â”€ api</span><br><span class="line">    â”‚Â Â  â””â”€â”€ user.go</span><br><span class="line">    â””â”€â”€ db</span><br><span class="line">        â””â”€â”€ db.go</span><br><span class="line"></span><br><span class="line">12 directories, 16 files</span><br></pre></td></tr></table></figure>

<blockquote>
<p>NOTE: <code>user</code> é¡¹ç›®<a href="https://github.com/jianghushinian/blog-go-example/tree/main/wire/user" target="_blank" rel="noopener">æºç åœ¨æ­¤</a>ï¼Œä½ å¯ä»¥ç‚¹å‡»æŸ¥çœ‹ï¼Œå»ºè®®ä¸‹è½½ä¸‹æ¥æ‰§è¡Œå¯åŠ¨ä¸‹ç¨‹åºï¼ŒåŠ æ·±ç†è§£ã€‚</p>
</blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ Web åº”ç”¨ï¼Œç”¨æ¥å¯¹ç”¨æˆ·è¿›è¡Œ CRUDã€‚ä¸è¿‡ä¸ºäº†ä¿æŒä»£ç ç®€æ´æ¸…æ™°ï¼Œæ–¹ä¾¿ç†è§£ï¼Œ<code>user</code> é¡¹ç›®ä»…å®ç°äº†åˆ›å»ºç”¨æˆ·çš„åŠŸèƒ½ã€‚</p>
<p>æˆ‘å…ˆç®€å•ä»‹ç»ä¸‹å„ä¸ªç›®å½•çš„åŠŸèƒ½ã€‚</p>
<p><code>assets</code> åŠªç›®å½•ç”¨äºå­˜æ”¾é¡¹ç›®èµ„æºã€‚<code>schema.sql</code> ä¸­æ˜¯å»ºè¡¨è¯­å¥ï¼Œ<code>curl.sh</code> ä¿å­˜äº†ä¸€ä¸ª <code>curl</code> è¯·æ±‚å‘½ä»¤ï¼Œç”¨äºæµ‹è¯•åˆ›å»ºç”¨æˆ·åŠŸèƒ½ã€‚</p>
<p><code>cmd</code> ä¸­å½“ç„¶æ˜¯ç¨‹åºå…¥å£æ–‡ä»¶ã€‚</p>
<p><code>internal</code> ä¸‹ä¿å­˜äº†é¡¹ç›®ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p><code>pkg</code> ç›®å½•å­˜æ”¾å¯å¯¼å‡ºçš„å…¬å…±åº“ã€‚<code>api</code> ç”¨äºå­˜æ”¾è¯·æ±‚å¯¹è±¡ï¼›<code>db</code> ç”¨äºæ„é€ æ•°æ®åº“å¯¹è±¡ã€‚</p>
<p>é¡¹ç›®è®¾è®¡äº† 4 å±‚æ¶æ„ï¼Œ<code>controller</code> å³å¯¹åº” MVC ç»å…¸æ¨¡å¼ä¸­çš„ Controllerï¼Œ<code>biz</code> æ˜¯ä¸šåŠ¡å±‚ï¼Œ<code>store</code> å±‚ç”¨äºè·Ÿæ•°æ®åº“äº¤äº’ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>model</code> å±‚å®šä¹‰æ¨¡å‹ï¼Œç”¨äºæ˜ å°„æ•°æ®åº“è¡¨ã€‚</p>
<p><code>router.go</code> ç”¨äºæ³¨å†Œè·¯ç”±ã€‚</p>
<p><code>user.go</code> ç”¨äºå®šä¹‰åˆ›å»ºå’Œå¯åŠ¨ <code>user</code> æœåŠ¡çš„åº”ç”¨å¯¹è±¡ã€‚</p>
<p>è€Œ <code>wire.go</code> å’Œ <code>wire_gen.go</code> ä¸¤ä¸ªæ–‡ä»¶å°±æ— éœ€æˆ‘è¿‡å¤šè®²è§£äº†ã€‚</p>
<blockquote>
<p>NOTE: æœ¬é¡¹ç›®ç›®å½•ç»“æ„éµå¾ªæœ€ä½³å®è·µï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« <a href="https://jianghushinian.cn/2023/02/25/how-to-design-a-good-go-web-project-directory-structure/" target="_blank" rel="noopener">ã€Šå¦‚ä½•è®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„ Go Web é¡¹ç›®ç›®å½•ç»“æ„ã€‹</a>ã€‚</p>
</blockquote>
<p>ç®€å•ä»‹ç»å®Œäº†ç›®å½•ç»“æ„ï¼Œå†æ¥æ¢³ç†ä¸‹æˆ‘ä»¬æ‰€è®¾è®¡çš„ 4 å±‚æ¶æ„ä¾èµ–å…³ç³»ï¼šé¦–å…ˆ <code>controller</code> å±‚ä¾èµ– <code>biz</code> å±‚ï¼Œç„¶å <code>biz</code> å±‚åˆä¾èµ– <code>store</code> å±‚ï¼Œæ¥ç€ <code>store</code> å±‚åˆä¾èµ–äº†æ•°æ®åº“ï¼ˆå³ä¾èµ– <code>pkg/db/</code>ï¼‰ï¼Œè€Œ <code>controller</code>ã€<code>biz</code>ã€<code>store</code> è¿™ä¸‰è€…åˆéƒ½ä¾èµ– <code>model</code> å±‚ã€‚</p>
<p>ç°åœ¨çœ‹äº†æˆ‘çš„è®²è§£ï¼Œä½ å¯èƒ½æœ‰äº›å‘æ‡µï¼Œæ²¡å…³ç³»ï¼Œä¸‹é¢æˆ‘å°†ä¸»è¦ä»£ç é€»è¾‘éƒ½è´´å‡ºæ¥ï¼ŒåŠ æ·±ä½ çš„ç†è§£ã€‚</p>
<p><code>assets/schema.sql</code> ä¸­çš„å»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span></span><br><span class="line">(</span><br><span class="line">    <span class="string">`id`</span>        <span class="built_in">BIGINT</span>       <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="string">`email`</span>     <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    <span class="string">`nickname`</span>  <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    <span class="string">`username`</span>  <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`password`</span>  <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`createdAt`</span> DATETIME,</span><br><span class="line">    <span class="string">`updatedAt`</span> DATETIME,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4;</span><br></pre></td></tr></table></figure>

<p><code>user</code> é¡¹ç›®ä»…æœ‰ä¸€å¼ è¡¨ã€‚</p>
<p><code>cmd/main.go</code> ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	user <span class="string">"github.com/jianghushinian/blog-go-example/wire/user/internal"</span></span><br><span class="line">	<span class="string">"github.com/jianghushinian/blog-go-example/wire/user/internal/config"</span></span><br><span class="line">	<span class="string">"github.com/jianghushinian/blog-go-example/wire/user/pkg/db"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cfg := &amp;config.Config&#123;</span><br><span class="line">		MySQL: db.MySQLOptions&#123;</span><br><span class="line">			Address:  <span class="string">"127.0.0.1:3306"</span>,</span><br><span class="line">			Database: <span class="string">"user"</span>,</span><br><span class="line">			Username: <span class="string">"root"</span>,</span><br><span class="line">			Password: <span class="string">"123456"</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	app, cleanup, err := user.NewApp(cfg)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">defer</span> cleanup()</span><br><span class="line">	app.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¥å£å‡½æ•° <code>main</code> ä¸­å…ˆåˆ›å»ºäº†é…ç½®å¯¹è±¡ <code>cfg</code>ï¼Œæ¥ç€å®ä¾‹åŒ– <code>app</code> å¯¹è±¡ï¼Œæœ€åè°ƒç”¨ <code>app.Run()</code> å¯åŠ¨ <code>user</code> æœåŠ¡ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå…¸å‹çš„ Web åº”ç”¨å¯åŠ¨æ­¥éª¤ã€‚</p>
<p><code>Config</code> å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Config <span class="keyword">struct</span> &#123;</span><br><span class="line">	MySQL db.MySQLOptions <span class="string">`json:"mysql" yaml:"mysql"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MySQLOptions <span class="keyword">struct</span> &#123;</span><br><span class="line">	Address  <span class="keyword">string</span></span><br><span class="line">	Database <span class="keyword">string</span></span><br><span class="line">	Username <span class="keyword">string</span></span><br><span class="line">	Password <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>user.go</code> ä¸­çš„ <code>App</code> å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App ä»£è¡¨ä¸€ä¸ª Web åº”ç”¨</span></span><br><span class="line"><span class="keyword">type</span> App <span class="keyword">struct</span> &#123;</span><br><span class="line">	*config.Config</span><br><span class="line"></span><br><span class="line">	g  *gin.Engine</span><br><span class="line">	uc *controller.UserController</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewApp Web åº”ç”¨æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewApp</span><span class="params">(cfg *config.Config)</span> <span class="params">(*App, <span class="keyword">func</span>()</span>, <span class="title">error</span>)</span> &#123;</span><br><span class="line">	gormDB, cleanup, err := db.NewMySQL(&amp;cfg.MySQL)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	userStore := store.New(gormDB)</span><br><span class="line">	userBiz := biz.New(userStore)</span><br><span class="line">	userController := controller.New(userBiz)</span><br><span class="line">	</span><br><span class="line">	engine := gin.Default()</span><br><span class="line">	app := &amp;App&#123;</span><br><span class="line">		Config: cfg,</span><br><span class="line">		g:      engine,</span><br><span class="line">		uc:     userController,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> app, cleanup, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run å¯åŠ¨ Web åº”ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *App)</span> <span class="title">Run</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// æ³¨å†Œè·¯ç”±</span></span><br><span class="line">	InitRouter(a)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := a.g.Run(<span class="string">":8000"</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>App</code> ä»£è¡¨ä¸€ä¸ª Web åº”ç”¨ï¼Œå®ƒåµŒå…¥äº†é…ç½®ã€<code>gin</code> æ¡†æ¶çš„ <code>*Engine</code> å¯¹è±¡ï¼Œä»¥åŠ <code>controller</code>ã€‚</p>
<p><code>NewApp</code> æ˜¯ <code>App</code> çš„æ„é€ å‡½æ•°ï¼Œé€šè¿‡ <code>Config</code> æ¥åˆ›å»ºä¸€ä¸ª <code>*App</code> å¯¹è±¡ã€‚</p>
<p>æ ¹æ®å…¶å†…éƒ¨ä»£ç é€»è¾‘ï¼Œä¹Ÿèƒ½çœ‹å‡ºé¡¹ç›®çš„ 4 å±‚æ¶æ„ä¾èµ–å…³ç³»ï¼šåˆ›å»º <code>App</code> å¯¹è±¡ä¾èµ– <code>Config</code>ï¼Œ<code>Config</code> æ˜¯é€šè¿‡å‚æ•°ä¼ é€’è¿›æ¥çš„ï¼›<code>*Engine</code> å¯¹è±¡å¯ä»¥é€šè¿‡ <code>gin.Default()</code> å¾—åˆ°ï¼›è€Œ <code>userController</code> åˆ™é€šè¿‡ <code>controller.New</code> åˆ›å»ºï¼Œ<code>controller</code> ä¾èµ– <code>biz</code>ï¼Œ<code>biz</code> ä¾èµ– <code>store</code>ï¼Œ<code>store</code> ä¾èµ– <code>*gorm.DB</code>ã€‚</p>
<p>å¯ä»¥å‘ç°ï¼Œä¾èµ–å…³ç³»éå¸¸æ¸…æ™°ï¼Œå¹¶ä¸”æˆ‘ä»¬ä½¿ç”¨äº†ä¾èµ–æ³¨å…¥æ€æƒ³ç¼–å†™ä»£ç ï¼Œé‚£ä¹ˆæ­¤æ—¶ï¼Œæ­£æ˜¯ wire çš„ç”¨æ­¦ä¹‹åœ°ã€‚</p>
<p>ä¸è¿‡ï¼Œæˆ‘ä»¬å…ˆä¸æ€¥ç€è®²è§£å¦‚ä½•åœ¨è¿™é‡Œä½¿ç”¨ wireã€‚æˆ‘å…ˆå°†é¡¹ç›®å‰©ä½™ä¸»è¦ä»£ç è´´å‡ºæ¥ï¼Œä¾¿äºä½ ç†è§£è¿™ä¸ª Web åº”ç”¨ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>pkg/db/db.go</code> ä¸­çš„ <code>NewMySQL</code> åˆ›å»ºå‡º <code>*gorm.DB</code> å¯¹è±¡ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NewMySQL æ ¹æ®é€‰é¡¹æ„é€  *gorm.DB</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMySQL</span><span class="params">(opts *MySQLOptions)</span> <span class="params">(*gorm.DB, <span class="keyword">func</span>()</span>, <span class="title">error</span>)</span> &#123;</span><br><span class="line">	<span class="comment">// å¯ä»¥ç”¨æ¥é‡Šæ”¾èµ„æºï¼Œè¿™é‡Œä»…ä½œä¸ºç¤ºä¾‹ä½¿ç”¨ï¼Œæ²¡æœ‰é‡Šæ”¾ä»»ä½•èµ„æºï¼Œå› ä¸º gorm å†…éƒ¨å·²ç»å¸®æˆ‘ä»¬åšäº†</span></span><br><span class="line">	cleanFunc := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">	db, err := gorm.Open(mysql.Open(opts.DSN()), &amp;gorm.Config&#123;</span><br><span class="line">		Logger: logger.Default.LogMode(logger.Silent),</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">return</span> db, cleanFunc, err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰äº† <code>*gorm.DB</code> å°±å¯ä»¥åˆ›å»º <code>store</code> å¯¹è±¡äº†ï¼Œ<code>internal/store/user.go</code> ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> store</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// ProviderSet ä¸€ä¸ª Wire provider setsï¼Œç”¨æ¥åˆå§‹åŒ– store å®ä¾‹å¯¹è±¡ï¼Œå¹¶å°† UserStore æ¥å£ç»‘å®šåˆ° *userStore ç±»å‹å®ç°ä¸Š</span></span><br><span class="line"><span class="keyword">var</span> ProviderSet = wire.NewSet(New, wire.Bind(<span class="built_in">new</span>(UserStore), <span class="built_in">new</span>(*userStore)))</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserStore å®šä¹‰ user æš´éœ²çš„ CRUD æ–¹æ³•</span></span><br><span class="line"><span class="keyword">type</span> UserStore <span class="keyword">interface</span> &#123;</span><br><span class="line">	Create(ctx context.Context, user *model.UserM) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserStore æ¥å£å®ç°</span></span><br><span class="line"><span class="keyword">type</span> userStore <span class="keyword">struct</span> &#123;</span><br><span class="line">	db *gorm.DB</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¡®ä¿ userStore å®ç°äº† UserStore æ¥å£</span></span><br><span class="line"><span class="keyword">var</span> _ UserStore = (*userStore)(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// New userStore æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(db *gorm.DB)</span> *<span class="title">userStore</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;userStore&#123;db&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create æ’å…¥ä¸€æ¡ user è®°å½•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *userStore)</span> <span class="title">Create</span><span class="params">(ctx context.Context, user *model.UserM)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> u.db.Create(&amp;user).Error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰äº† <code>store</code> å°±å¯ä»¥åˆ›å»º <code>biz</code> å¯¹è±¡äº†ï¼Œ<code>internal/biz/user.go</code> ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> biz</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// ProviderSet ä¸€ä¸ª Wire provider setsï¼Œç”¨æ¥åˆå§‹åŒ– biz å®ä¾‹å¯¹è±¡ï¼Œå¹¶å°† UserBiz æ¥å£ç»‘å®šåˆ° *userBiz ç±»å‹å®ç°ä¸Š</span></span><br><span class="line"><span class="keyword">var</span> ProviderSet = wire.NewSet(New, wire.Bind(<span class="built_in">new</span>(UserBiz), <span class="built_in">new</span>(*userBiz)))</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserBiz å®šä¹‰ user ä¸šåŠ¡é€»è¾‘æ“ä½œæ–¹æ³•</span></span><br><span class="line"><span class="keyword">type</span> UserBiz <span class="keyword">interface</span> &#123;</span><br><span class="line">	Create(ctx context.Context, r *api.CreateUserRequest) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserBiz æ¥å£çš„å®ç°</span></span><br><span class="line"><span class="keyword">type</span> userBiz <span class="keyword">struct</span> &#123;</span><br><span class="line">	s store.UserStore</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¡®ä¿ userBiz å®ç°äº† UserBiz æ¥å£</span></span><br><span class="line"><span class="keyword">var</span> _ UserBiz = (*userBiz)(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// New userBiz æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(s store.UserStore)</span> *<span class="title">userBiz</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;userBiz&#123;s: s&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create åˆ›å»ºç”¨æˆ·</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *userBiz)</span> <span class="title">Create</span><span class="params">(ctx context.Context, r *api.CreateUserRequest)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> userM model.UserM</span><br><span class="line">	_ = copier.Copy(&amp;userM, r)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> b.s.Create(ctx, &amp;userM)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ï¼Œæœ‰äº† <code>biz</code> å°±å¯ä»¥åˆ›å»º <code>controller</code> å¯¹è±¡äº†ï¼Œ<code>internal/controller/user.go</code> ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controller</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserController ç”¨æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚</span></span><br><span class="line"><span class="keyword">type</span> UserController <span class="keyword">struct</span> &#123;</span><br><span class="line">	b biz.UserBiz</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// New controller æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(b biz.UserBiz)</span> *<span class="title">UserController</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;UserController&#123;b: b&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create åˆ›å»ºç”¨æˆ·</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ctrl *UserController)</span> <span class="title">Create</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> r api.CreateUserRequest</span><br><span class="line">	<span class="keyword">if</span> err := c.ShouldBindJSON(&amp;r); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusBadRequest, gin.H&#123;</span><br><span class="line">			<span class="string">"err"</span>: err.Error(),</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := ctrl.b.Create(c, &amp;r); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusInternalServerError, gin.H&#123;</span><br><span class="line">			<span class="string">"err"</span>: err.Error(),</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™äº›å¯¹è±¡éƒ½æœ‰äº†ï¼Œå°±å¯ä»¥è°ƒç”¨ <code>NewApp</code> æ„é€ å‡º <code>App</code> äº†ã€‚</p>
<p><code>App</code> åœ¨å¯åŠ¨å‰ï¼Œè¿˜ä¼šè°ƒç”¨ <code>InitRouter</code> è¿›è¡Œè·¯ç”±æ³¨å†Œï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// InitRouter åˆå§‹åŒ–è·¯ç”±</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitRouter</span><span class="params">(a *App)</span></span> &#123;</span><br><span class="line">	<span class="comment">// åˆ›å»º users è·¯ç”±åˆ†ç»„</span></span><br><span class="line">	u := a.g.Group(<span class="string">"/users"</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		u.POST(<span class="string">""</span>, a.uc.Create)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ <code>user</code> é¡¹ç›®é€»è¾‘å·²ç»æ¸…æ™°äº†ï¼Œæ˜¯æ—¶å€™å¯åŠ¨åº”ç”¨ç¨‹åºäº†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> user   </span><br><span class="line">$ go run cmd/main.go</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºå¯åŠ¨åï¼Œä¼šç›‘å¬ <code>8000</code> ç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨ <code>assets/curl.sh</code> ä¸­çš„ <code>curl</code> å‘½ä»¤è¿›è¡Œè®¿é—®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl --location --request POST <span class="string">'http://127.0.0.1:8000/users'</span> \</span><br><span class="line">--header <span class="string">'Content-Type: application/json'</span> \</span><br><span class="line">--data-raw <span class="string">'&#123;</span></span><br><span class="line"><span class="string">    "email": "jianghushinian007@outlook.com",</span></span><br><span class="line"><span class="string">    "nickname": "æ±Ÿæ¹–åå¹´",</span></span><br><span class="line"><span class="string">    "username": "jianghushinian",</span></span><br><span class="line"><span class="string">    "password": "pass"</span></span><br><span class="line"><span class="string">&#125;'</span></span><br></pre></td></tr></table></figure>

<p>ä¸å‡ºæ„å¤–ï¼Œä½ å°†åœ¨æ•°æ®åº“ä¸­çœ‹åˆ°æ–°åˆ›å»ºçš„ç”¨æˆ·ã€‚</p>
<p>æ‰§è¡Œä»¥ä¸‹ SQLï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<p>å°†è¾“å‡ºæ–°åˆ›å»ºå‡ºæ¥çš„ç”¨æˆ·ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------------------------+----------+----------------+----------+---------------------+---------------------+</span><br><span class="line">| id | email                         | nickname | username       | password | createdAt           | updatedAt           |</span><br><span class="line">+----+-------------------------------+----------+----------------+----------+---------------------+---------------------+</span><br><span class="line">|  1 | jianghushinian007@outlook.com | æ±Ÿæ¹–åå¹´  | jianghushinian | pass     | 2024-06-11 00:01:35 | 2024-06-11 00:01:35 |</span><br><span class="line">+----+-------------------------------+----------+----------------+----------+---------------------+---------------------+</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæ˜¯æ—¶å€™è®¨è®ºå¦‚ä½•åœ¨ <code>user</code> é¡¹ç›®ä¸­ä½¿ç”¨ wire æ¥æé«˜å¼€å‘æ•ˆç‡äº†ã€‚</p>
<p>å›é¡¾ä¸‹ <code>NewApp</code> çš„å®šä¹‰ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NewApp Web åº”ç”¨æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewApp</span><span class="params">(cfg *config.Config)</span> <span class="params">(*App, <span class="keyword">func</span>()</span>, <span class="title">error</span>)</span> &#123;</span><br><span class="line">	gormDB, cleanup, err := db.NewMySQL(&amp;cfg.MySQL)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	userStore := store.New(gormDB)</span><br><span class="line">	userBiz := biz.New(userStore)</span><br><span class="line">	userController := controller.New(userBiz)</span><br><span class="line">	</span><br><span class="line">	engine := gin.Default()</span><br><span class="line">	app := &amp;App&#123;</span><br><span class="line">		Config: cfg,</span><br><span class="line">		g:      engine,</span><br><span class="line">		uc:     userController,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> app, cleanup, err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶å®è¿™é‡Œé¢ä¸€å±‚å±‚çš„ä¾èµ–æ³¨å…¥ï¼Œéƒ½æ˜¯å¥—è·¯ä»£ç ï¼ŒåŸºæœ¬ä¸Šä¸€ä¸ª Web åº”ç”¨éƒ½å¯ä»¥æŒ‰ç…§è¿™ä¸ªå¥—è·¯æ¥å†™ã€‚</p>
<p>è¿™å°±æ¶‰åŠåˆ°å¥—è·¯ä»£ç å†™å¤šäº†å…¶å®æ˜¯æ¯”è¾ƒçƒ¦çš„ï¼Œè¿™è¿˜åªæ˜¯ä¸€ä¸ªå¾®å‹é¡¹ç›®ï¼Œå¦‚æœæ˜¯ä¸­å¤§é¡¹ç›®ï¼Œå¯ä»¥é¢„è§è¿™ä¸ª <code>NewApp</code> ä»£ç é‡ä¼šå¾ˆå¤šï¼Œæ‰€ä»¥æ˜¯æ—¶å€™è®© wire å‡ºåœºäº†ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewApp</span><span class="params">(cfg *config.Config)</span> <span class="params">(*App, <span class="keyword">func</span>()</span>, <span class="title">error</span>)</span> &#123;</span><br><span class="line">	engine := gin.Default()</span><br><span class="line">	app, cleanup, err := wireApp(engine, cfg, &amp;cfg.MySQL)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> app, cleanup, err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å°† <code>NewApp</code> ä¸­çš„ä¸»é€»è¾‘å…¨éƒ¨æ‹¿èµ°ï¼Œæ”¾åœ¨ <code>wireApp</code> ä¸­ï¼ˆåœ¨ <code>wire.go</code> æ–‡ä»¶ä¸­ï¼‰ã€‚</p>
<p><code>wireApp</code> å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">wireApp</span><span class="params">(engine *gin.Engine, cfg *config.Config, mysqlOptions *db.MySQLOptions)</span> <span class="params">(*App, <span class="keyword">func</span>()</span>, <span class="title">error</span>)</span> &#123;</span><br><span class="line">	wire.Build(</span><br><span class="line">		db.NewMySQL,</span><br><span class="line">		store.ProviderSet,</span><br><span class="line">		biz.ProviderSet,</span><br><span class="line">		controller.New,</span><br><span class="line">		wire.Struct(<span class="built_in">new</span>(App), <span class="string">"*"</span>),</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰äº†å‰æ–‡çš„è®²è§£ï¼Œå…¶å®è¿™é‡Œæ— éœ€æˆ‘å¤šè¨€ï¼Œä½ éƒ½èƒ½å¤Ÿçœ‹æ‡‚ï¼Œå› ä¸ºå¹¶æ²¡æœ‰æ–°çš„çŸ¥è¯†ã€‚</p>
<p>ä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯ç®€å•åˆ†æä¸‹è¿™é‡Œéƒ½ç”¨åˆ°äº† wire çš„å“ªäº›ç‰¹æ€§ã€‚</p>
<p>é¦–å…ˆ <code>wireApp</code> è¿”å›å€¼æ˜¯å…¸å‹çš„ä¸‰ä»¶å¥—ï¼š<code>(*App, func(), error)</code>ï¼Œå¯¹è±¡ã€æ¸…ç†å‡½æ•°å’Œ <code>error</code>ã€‚</p>
<p>è¿™é‡Œä½¿ç”¨äº†ä¸¤ä¸ª <code>wire.ProviderSet</code> è¿›è¡Œåˆ†ç»„ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ProviderSet = wire.NewSet(New, wire.Bind(<span class="built_in">new</span>(UserStore), <span class="built_in">new</span>(*userStore)))</span><br><span class="line"><span class="keyword">var</span> ProviderSet = wire.NewSet(New, wire.Bind(<span class="built_in">new</span>(UserBiz), <span class="built_in">new</span>(*userBiz)))</span><br></pre></td></tr></table></figure>

<p>å¹¶ä¸”åœ¨æ„é€  <code>wire.ProviderSet</code> æ—¶ï¼Œè¿˜ä½¿ç”¨äº† <code>wire.Bind(new(UserStore), new(*userStore))</code> å°†ä¸€ä¸ªç»“æ„ä½“ç»‘å®šåˆ°æ¥å£ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>struct</code> ä½œä¸º <code>provider</code>ï¼š<code>wire.Struct(new(App), &quot;*&quot;)</code> ï¼Œé€šé…ç¬¦ <code>*</code> ç”¨æ¥è¡¨ç¤ºæ‰€æœ‰å­—æ®µã€‚</p>
<p>åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œwire å°±è¿™ä¹ˆä½¿ç”¨ã€‚</p>
<p>å¦‚æœä½ è§‰å¾— <code>user</code> é¡¹ç›®å¤ªå°ï¼Œä½¿ç”¨ wire çš„ä»·å€¼è¿˜ä¸å¤Ÿå¤§ã€‚ä½ å¯ä»¥çœ‹çœ‹ <code>onex</code> é¡¹ç›®ï¼Œæ¯”å¦‚ <a href="https://github.com/superproj/onex/blob/master/internal/usercenter/wire.go" target="_blank" rel="noopener">usercenter</a> ä¸­çš„ä»£ç ï¼Œè¿™ä¸ªå¼€æºé¡¹ç›®å®Œå…¨æ˜¯ç”Ÿäº§çº§åˆ«ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆé€‰æ‹©-Wire"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©-Wire" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹© Wire"></a>ä¸ºä»€ä¹ˆé€‰æ‹© Wire</h3><p>é€šå¸¸æ¥è¯´ï¼Œè¿™éƒ¨åˆ†å†…å®¹æ˜¯åº”è¯¥æ”¾åœ¨æ–‡ç« å¼€å¤´çš„ã€‚æˆ‘å°†å…¶æ”¾åœ¨è¿™é‡Œï¼Œç›®çš„æ˜¯ä¸ºäº†è®©ä½ ç†Ÿæ‚‰ wire åï¼Œå†å›è¿‡å¤´æ¥å¯¹æ¯”ï¼Œwire æœ‰å“ªäº›ä¼˜åŠ¿ï¼ŒåŠ æ·±ä½ å¯¹ä¸ºä»€ä¹ˆé€‰æ‹© wire çš„ç†è§£ã€‚</p>
<p>å…¶å® Go ç”Ÿæ€ä¸­ä¾èµ–æ³¨å…¥å·¥å…·ä¸æ­¢æœ‰ Google çš„ <a href="https://github.com/google/wire" target="_blank" rel="noopener">wire</a> ä¸€å®¶ç‹¬å¤§ï¼Œè¿˜æœ‰ Uber å¼€æºçš„ <a href="https://github.com/uber-go/dig" target="_blank" rel="noopener">dig</a>ï¼Œä»¥åŠ Facebook å¼€æºçš„ <a href="github.com/facebookarchive/inject">inject</a> æ¯”è¾ƒæµè¡Œã€‚</p>
<p>ä½†æˆ‘ä¸ºä»€ä¹ˆè¦é€‰æ‹© wireï¼Ÿ</p>
<p>ä¸€å¥è¯æ¦‚æ‹¬ï¼šwire ä½¿ç”¨<strong>ä»£ç ç”Ÿæˆ</strong>ï¼Œè€Œé<strong>åå°„</strong>ã€‚</p>
<p> æˆ‘ä»¬å¯ä»¥åˆ†åˆ«ä¸¾ä¾‹çœ‹ä¸‹ dig ä»¥åŠ inject æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p>
<p>dig çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"go.uber.org/dig"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewUser - Creates a new instance of User</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewUser</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="title">User</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> User&#123;name: name&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get - A method with user as dependency</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span> <span class="title">Get</span><span class="params">(message <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"Hello %s - %s"</span>, u.name, message)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run - Depends on user and calls the Get method on User</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Run</span><span class="params">(user User)</span></span> &#123;</span><br><span class="line">	result := user.Get(<span class="string">"It's nice to meet you!"</span>)</span><br><span class="line">	fmt.Println(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// Initialize a new dig container</span></span><br><span class="line">	container := dig.New()</span><br><span class="line">	<span class="comment">// Provide a name parameter to the container</span></span><br><span class="line">	container.Provide(<span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">string</span></span> &#123; <span class="keyword">return</span> <span class="string">"jianghushinian"</span> &#125;)</span><br><span class="line">	<span class="comment">// Provide a new User instance to the container using the name injected above</span></span><br><span class="line">	<span class="keyword">if</span> err := container.Provide(NewUser); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Invoke the Run function; Dig automatically injects the User instance provided above</span></span><br><span class="line">	<span class="keyword">if</span> err := container.Invoke(Run); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç®€å•è§£é‡Šä¸‹ç¤ºä¾‹ä»£ç ï¼š</p>
<p><code>dig.New()</code> å®ä¾‹åŒ–ä¸€ä¸ª dig å®¹å™¨ã€‚</p>
<p><code>container.Provide(func() string { return &quot;jianghushinian&quot; })</code> å°†ä¸€ä¸ªåŒ¿åå‡½æ•°æä¾›ç»™å®¹å™¨ã€‚</p>
<p>ç„¶åè°ƒç”¨ <code>container.Provide(NewUser)</code>ï¼Œdig é¦–å…ˆå°†å­—ç¬¦ä¸²å€¼ <code>jianghushinian</code> ä½œä¸º <code>name</code> å‚æ•°æä¾›ç»™ <code>NewUser</code> å‡½æ•°ã€‚ä¹‹åï¼Œ<code>NewUser</code> å‡½æ•°ä¼šæ ¹æ®æ­¤å€¼åˆ›å»ºå‡ºæ¥ä¸€ä¸ª <code>User</code> ç»“æ„ä½“çš„æ–°å®ä¾‹ï¼Œéšå dig å°†å…¶æä¾›ç»™å®¹å™¨ã€‚</p>
<p>æœ€åï¼Œ<code>container.Invoke(Run)</code> ä¼šå°†å®¹å™¨ä¸­ä¿å­˜çš„ <code>User</code> ç»“æ„ä½“ä¼ é€’ç»™ <code>Run</code> å‡½æ•°å¹¶è¿è¡Œã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç±»æ¯” wire æ¥å­¦ä¹  digï¼šå¯ä»¥æŠŠ <code>Provide</code> çœ‹ä½œ <code>providers</code>ï¼Œ<code>Invoke</code> çœ‹ä½œ <code>injectors</code>ï¼Œè¿™æ ·å°±å¥½ç†è§£äº†ã€‚</p>
<p>ä»¥ä¸Šç¤ºä¾‹ä»£ç å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œæ— éœ€åƒä½¿ç”¨ wire ä¸€æ ·éœ€è¦æå‰ç”Ÿæˆä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run main.go</span><br><span class="line">Hello jianghushinian - It&#39;s nice to meet you!</span><br></pre></td></tr></table></figure>

<p>è¿™å°±æ˜¯ dig çš„ä½¿ç”¨ã€‚</p>
<p>å†æ¥çœ‹ä¸€ä¸ª inject çš„ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/facebookgo/inject"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span> <span class="string">`inject:"name"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get - A method with user as dependency</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span> <span class="title">Get</span><span class="params">(message <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"Hello %s - %s"</span>, u.Name, message)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run - Depends on user and calls the Get method on User</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Run</span><span class="params">(user *User)</span></span> &#123;</span><br><span class="line">	result := user.Get(<span class="string">"It's nice to meet you!"</span>)</span><br><span class="line">	fmt.Println(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// new an inject Graph</span></span><br><span class="line">	<span class="keyword">var</span> g inject.Graph</span><br><span class="line"></span><br><span class="line">	<span class="comment">// inject name</span></span><br><span class="line">	name := <span class="string">"jianghushinian"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// provide string value</span></span><br><span class="line">	err := g.Provide(&amp;inject.Object&#123;Value: name, Name: <span class="string">"name"</span>&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// create a User instance and supply it to the dependency graph</span></span><br><span class="line">	user := &amp;User&#123;&#125;</span><br><span class="line">	err = g.Provide(&amp;inject.Object&#123;Value: user&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// resolve all dependencies</span></span><br><span class="line">	err = g.Populate()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	Run(user)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç¤ºä¾‹ä»£ç æˆ‘å°±ä¸è¯¦ç»†è®²è§£äº†ï¼Œå­¦ä¼šäº† wire å’Œ digï¼Œè¿™æ®µä»£ç å¾ˆå®¹æ˜“ç†è§£ã€‚</p>
<p>å¯ä»¥å‘ç°çš„æ˜¯ï¼Œæ— è®ºæ˜¯ dig è¿˜æ˜¯ injectï¼Œå®ƒä»¬ä½¿ç”¨çš„éƒ½æ˜¯è¿è¡Œæ—¶åå°„æœºåˆ¶ï¼Œæ¥å®ç°ä¾èµ–æ³¨å…¥åŠŸèƒ½ã€‚</p>
<p>è¿™ä¼šå¸¦æ¥æœ€ç›´è§‚çš„ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>ä½¿ç”¨åå°„å¯èƒ½å½±å“æ€§èƒ½ã€‚</li>
<li>æˆ‘ä»¬éœ€è¦æ ¹æ®å·¥å…·çš„è¦æ±‚ç¼–å†™ä»£ç ï¼Œè€Œè¿™ä»½ä»£ç æ­£ç¡®ä¸å¦ï¼Œåªæœ‰åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»£ç æ˜¯â€œé»‘ç›’â€çš„ï¼Œé€šè¿‡ review ä»£ç ï¼Œå¾ˆéš¾ä¸€çœ¼çœ‹å‡ºä»£ç æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚</li>
</ol>
<p>è€Œ wire é‡‡ç”¨ä»£ç ç”Ÿæˆï¼Œå®ƒä¼šæ ¹æ®æˆ‘ä»¬ç¼–å†™çš„ <code>injector</code> å‡½æ•°ç­¾åï¼Œç”Ÿæˆæœ€ç»ˆä»£ç ã€‚æ‰€ä»¥åœ¨æ‰§è¡Œä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å°±å·²ç»æœ‰äº† <code>injector</code> å‡½æ•°çš„æºç ã€‚</p>
<p>è¿™æ—¢ä¸ä¼šå½±å“æ€§èƒ½ï¼Œä¹Ÿä¸ä¼šè®©ä»£ç å˜æˆâ€œé»‘ç›’â€ï¼Œåœ¨æ‰§è¡Œç¨‹åºä¹‹å‰æˆ‘ä»¬å°±çŸ¥é“ä»£ç é•¿ä»€ä¹ˆæ ·ã€‚è€Œè¿™æ ·åšè¿˜èƒ½å¸¦æ¥ä¸€ä¸ªå¥½å¤„ï¼Œèƒ½å¤Ÿå¤§å¤§ç®€åŒ–æˆ‘ä»¬æ’é”™çš„è¿‡ç¨‹ã€‚</p>
<p>Python ä¹‹ç¦…ä¸­æœ‰ä¸€å¥è¯å«ã€Œæ˜¾å¼ä¼˜äºéšå¼ã€ï¼Œwire åšåˆ°äº†ã€‚</p>
<h3 id="Wire-å‘½ä»¤è¡Œå·¥å…·"><a href="#Wire-å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="Wire å‘½ä»¤è¡Œå·¥å…·"></a>Wire å‘½ä»¤è¡Œå·¥å…·</h3><p>æ–‡ç« æœ€åï¼Œæˆ‘å†æ¥ç®€å•ä»‹ç»ä¸‹ <code>wire</code> å‘½ä»¤è¡Œå·¥å…·ã€‚</p>
<p>ä¹‹æ‰€ä»¥æ”¾åœ¨æœ€åè®²è§£ï¼Œæ˜¯å› ä¸º <code>wire</code> çš„å­å‘½ä»¤ç¡®å®ä¸å¤ªå¸¸ç”¨ï¼Œå¦‚æœä½ å»ç½‘ä¸Šæœç´¢ï¼Œå‡ ä¹æ²¡äººä»‹ç»ã€‚ä¸è¿‡ä¸ºäº†ä¿è¯æ–‡ç« çš„å®Œæ•´æ€§ï¼Œæˆ‘è¿˜æ˜¯ç®€å•è®²è§£ä¸‹ï¼Œä½œä¸ºæ‰©å±•å†…å®¹ï¼Œä½ å¥½æœ‰ä¸ªå°è±¡ã€‚</p>
<p>ä½¿ç”¨ <code>--help</code> æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©ä¿¡æ¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ wire --<span class="built_in">help</span></span><br><span class="line">Usage: wire &lt;flags&gt; &lt;subcommand&gt; &lt;subcommand args&gt;</span><br><span class="line"></span><br><span class="line">Subcommands:</span><br><span class="line">        check            <span class="built_in">print</span> any Wire errors found</span><br><span class="line">        commands         list all <span class="built_in">command</span> names</span><br><span class="line">        diff             output a diff between existing wire_gen.go files and what gen would generate</span><br><span class="line">        flags            describe all known top-level flags</span><br><span class="line">        gen              generate the wire_gen.go file <span class="keyword">for</span> each package</span><br><span class="line">        <span class="built_in">help</span>             describe subcommands and their syntax</span><br><span class="line">        show             describe all top-level provider sets</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç° wire è¿æœ€åŸºæœ¬çš„ <code>--version</code> å‘½ä»¤éƒ½ä¸å­˜åœ¨ï¼Œå³ä¸æ”¯æŒæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ã€‚èµ·åˆè¿™ç‚¹æˆ‘æ˜¯ç–‘æƒ‘çš„ï¼Œä¸è¿‡çœ‹äº†å®˜æ–¹æè¿°ï¼Œä¹Ÿå°±ä¸è¶³ä¸ºå¥‡äº†ã€‚å› ä¸º wire å·²ç»ä¸å†åŠ å…¥æ–°åŠŸèƒ½ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç†è§£ä¸ºå®ƒå°±è¿™ä¸€ä¸ªç‰ˆæœ¬ã€‚</p>
<p>å®˜æ–¹æè¿°è¯´å½“å‰<a href="https://github.com/google/wire?tab=readme-ov-file#project-status" target="_blank" rel="noopener">é¡¹ç›®çŠ¶æ€</a>ä¸æ¥å—æ–°åŠŸèƒ½ï¼Œåªæ¥å—é”™è¯¯æŠ¥å‘Šå’Œ Bug fixã€‚çœ‹æ¥å®˜æ–¹ä¹Ÿæƒ³ä¿æŒ wire çš„ç®€æ´ã€‚</p>
<p>æœ‰äººè¯´é¡¹ç›®ä¸ç»´æŠ¤äº†ã€‚ä½†æˆ‘è®¤ä¸ºè¿™åˆä½•å°ä¸æ˜¯ä¸€ä»¶å¥½äº‹æƒ…ï¼Œå…¶å®é¡¹ç›®è¿˜åœ¨ç»´æŠ¤ï¼Œåªæ˜¯ä¸å¢åŠ æ–°åŠŸèƒ½äº†ã€‚è¿™åœ¨æ—¥æ–°æœˆå¼‚çš„æŠ€æœ¯è¡Œä¸šé‡Œï¼Œæ˜¯å¥½äº‹ï¼Œæå¤§çš„å¥½äº‹ã€‚æˆ‘ä»¬ä¸ç”¨æŠ•å…¥å¤ªå¤šç²¾åŠ›å­¦ä¹ è¿™ä¸ªå·¥å…·ï¼Œå­¦ä¸€æ¬¡å—ç”¨å¾ˆä¹…ã€‚è¿™ä¹Ÿæ˜¯æˆ‘å†™è¿™ç¯‡æƒ³ç€å°½é‡æŠŠ wire åŠŸèƒ½ä»‹ç»å®Œå…¨ï¼Œæ–¹ä¾¿å¤§å®¶å­¦ä¹ ã€‚</p>
<p>å›å½’æ­£é¢˜ï¼Œé¦–å…ˆè¦è®²è§£çš„æ˜¯ <code>gen</code> å­å‘½ä»¤ã€‚å·²ç»æ˜¯æˆ‘ä»¬çš„è€æœ‹å‹äº†ï¼Œå¯ä»¥æ ¹æ®æˆ‘ä»¬ç¼–å†™çš„ <code>injector</code> å‡½æ•°ç­¾åï¼Œè‡ªåŠ¨ç”Ÿæˆç›®æ ‡ä»£ç ã€‚</p>
<p>å…¶å®å¦‚æœç›´æ¥ä½¿ç”¨ <code>wire</code> å‘½ä»¤ï¼Œåé¢ä»€ä¹ˆä¹Ÿä¸æ¥ï¼Œ<code>wire</code> é»˜è®¤ä¼šè°ƒç”¨ <code>gen</code> å­å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wire       </span><br><span class="line">wire: github.com/jianghushinian/blog-go-example/wire/getting-started: wrote /Users/jianghushinian/projects/blog-go-example/wire/getting-started/wire_gen.go</span><br></pre></td></tr></table></figure>

<p><code>check</code> å­å‘½ä»¤å¯ä»¥å¸®æˆ‘ä»¬æ£€æŸ¥ä»£ç é”™è¯¯ï¼Œæ¯”å¦‚æˆ‘ä»¬å°† <a href="#Wire-å¿«é€Ÿå¼€å§‹">Wire å¿«é€Ÿå¼€å§‹</a> éƒ¨åˆ†çš„ç¤ºä¾‹ä¸­çš„ <code>injector</code> å‡½æ•° <code>InitializeEvent</code> æ•…æ„å†™é”™ã€‚</p>
<p><code>InitializeEvent</code> ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">()</span> <span class="title">Event</span></span> &#123;</span><br><span class="line">	wire.Build(NewEvent, NewGreeter, NewMessage)</span><br><span class="line">	<span class="keyword">return</span> Event&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä¿®æ”¹æˆé”™è¯¯çš„ï¼Œæ¼å†™äº† <code>NewMessage</code> æ–¹æ³•ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitializeEvent</span><span class="params">()</span> <span class="title">Event</span></span> &#123;</span><br><span class="line">	wire.Build(NewEvent, NewGreeter)</span><br><span class="line">	<span class="keyword">return</span> Event&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>wire check</code> æ£€æŸ¥ä»£ç é”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wire check</span><br><span class="line">wire: wire.go:7:1: inject InitializeEvent: no provider found <span class="keyword">for</span> github.com/jianghushinian/blog-go-example/wire/getting-started.Message</span><br><span class="line">        needed by github.com/jianghushinian/blog-go-example/wire/getting-started.Greeter <span class="keyword">in</span> provider <span class="string">"NewGreeter"</span> (main.go:15:6)</span><br><span class="line">        needed by github.com/jianghushinian/blog-go-example/wire/getting-started.Event <span class="keyword">in</span> provider <span class="string">"NewEvent"</span> (main.go:27:6)</span><br><span class="line">wire: error loading packages</span><br></pre></td></tr></table></figure>

<p>ä½†å…¶å®æˆ‘ä»¬ç›´æ¥æ‰§è¡Œ <code>wire</code> å‘½ä»¤ç”Ÿæˆä»£ç æ—¶ï¼Œä¹Ÿä¼šå¾—åˆ°ç›¸åŒçš„é”™è¯¯ã€‚</p>
<p><code>commands</code> å­å‘½ä»¤å¯ä»¥æ‰“å° <code>wire</code> æ”¯æŒçš„æ‰€æœ‰å­å‘½ä»¤ï¼Œå—¯ï¼Œä»…æ­¤è€Œå·²ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ wire commands</span><br><span class="line">commands</span><br><span class="line">flags</span><br><span class="line"><span class="built_in">help</span></span><br><span class="line">check</span><br><span class="line">diff</span><br><span class="line">gen</span><br><span class="line">show</span><br></pre></td></tr></table></figure>

<p><code>flags</code> å­å‘½ä»¤å¯ä»¥æ‰“å°æ¯ä¸ªå­å‘½ä»¤æ¥æ”¶çš„æ ‡å¿—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ wire flags gen</span><br><span class="line">  -header_file string</span><br><span class="line">        path to file to insert as a header <span class="keyword">in</span> wire_gen.go</span><br><span class="line">  -output_file_prefix string</span><br><span class="line">        string to prepend to output file names.</span><br><span class="line">  -tags string</span><br><span class="line">        append build tags to the default wirebuild</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç° <code>gen</code> å­å‘½ä»¤æ”¯æŒ 3 ä¸ªæ ‡å¿—ï¼Œè‡³äºæ•ˆæœä½ å¯ä»¥è‡ªè¡Œå°è¯•ã€‚</p>
<p><code>diff</code> å­å‘½ä»¤ç”¨äºæ‰“å° <code>wire</code> ç”Ÿæˆçš„ <code>wire_gen.go</code> æ–‡ä»¶å’Œä¹‹å‰æœ‰ä½•ä¸åŒï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ wire diff .    </span><br><span class="line">github.com/jianghushinian/blog-go-example/wire/getting-started: diff from wire_gen.go:</span><br><span class="line">@@ -11,2 +11,2 @@</span><br><span class="line">-func InitializeEvent() Event &#123;</span><br><span class="line">-       message := NewMessage()</span><br><span class="line">+func InitializeEvent(string2 string) Event &#123;</span><br><span class="line">+       message := NewMessage(string2)</span><br></pre></td></tr></table></figure>

<p><code>show</code> å­å‘½ä»¤ç”¨äºåˆ†æå’Œå±•ç¤ºæŒ‡å®šåŒ…ä¸­çš„ä¾èµ–æ³¨å…¥é…ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ wire show .    </span><br><span class="line"></span><br><span class="line">Injectors:</span><br><span class="line">        <span class="string">"github.com/jianghushinian/blog-go-example/wire/getting-started"</span>.InitializeEvent</span><br></pre></td></tr></table></figure>

<p><code>wire</code> å‘½ä»¤è¡Œå·¥å…·çš„è®²è§£å°±ä»‹ç»åˆ°è¿™é‡Œã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç»ˆäºåˆ°äº†æ€»ç»“ç¯èŠ‚ï¼Œåˆæ˜¯ä¸€ç¯‡ä¸‡å­—é•¿æ–‡ã€‚</p>
<p>æœ¬æ–‡ä¸»æ—¨æ˜¯ä¸ºäº†è®²è§£åœ¨ Go ä¸­ï¼Œå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·æé«˜å¼€å‘æ•ˆç‡ã€‚</p>
<p>é¦–å…ˆä»‹ç»äº†ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Œä»¥åŠåœ¨ Go ä¸­å¦‚ä½•ä½¿ç”¨ä¾èµ–æ³¨å…¥æ€æƒ³ç¼–å†™ä»£ç ã€‚</p>
<p>æ¥ç€åˆå¯¹ä¾èµ–æ³¨å…¥å·¥å…· wire è¿›è¡Œäº†ç®€å•ä»‹ç»ï¼Œå¹¶å®‰è£…äº† <code>wire</code> å‘½ä»¤è¡Œå·¥å…·ã€‚</p>
<p>ç„¶åé€šè¿‡ä¸€ä¸ª wire å¿«é€Ÿå¼€å§‹çš„ç¤ºä¾‹ç¨‹åºï¼Œæé€Ÿå…¥é—¨ wire çš„ä½¿ç”¨ã€‚</p>
<p>æœ‰äº†ä½¿ç”¨ç»éªŒï¼Œæˆ‘åˆè®²è§£äº†ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ wireï¼Ÿå› ä¸ºå®ƒä»¬å¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆä¾èµ–æ³¨å…¥ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘å¯¹ wire çš„æ ¸å¿ƒæ¦‚å¿µè¿›è¡Œäº†è®²è§£ã€‚æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯ <code>providers</code> å’Œ <code>injectors</code>ï¼ŒçŸ¥é“äº†è¿™ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œwire å°±å…¥é—¨äº†ã€‚</p>
<p>æˆ‘è¿˜ä»‹ç»äº† wire å’Œå¾ˆå¤šé«˜çº§ç‰¹æ€§ã€‚<code>injector</code> å‡½æ•°æ”¯æŒå‚æ•°ï¼Œä¹Ÿæ”¯æŒè¿”å›æ¸…ç†å‡½æ•°å’Œé”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>ProviderSet</code> å¯¹ <code>providers</code> è¿›è¡Œåˆ†ç»„ã€‚å¯ä»¥ä½¿ç”¨ <code>wire.Struct</code> å°†ä¸€ä¸ªç»“æ„ä½“ä½œä¸º <code>provider</code>ã€‚ä¹Ÿå¯ä»¥æŒ‡å®šç»“æ„ä½“çš„å…·ä½“æŸä¸ªå­—æ®µä½œä¸º <code>provider</code>ã€‚<code>wire.Value</code> å¯ä»¥å°†ä¸€ä¸ªå€¼æ„é€ æˆ <code>provider</code>ã€‚<code>wire.InterfaceValue</code> å¯ä»¥å°†ä¸€ä¸ªæ¥å£æ„é€ æˆ <code>provider</code>ã€‚é€šè¿‡ <code>wire.Bind(new(Fooer), new(MyFoo)))</code> å¯ä»¥å°† <code>MyFoo</code> ç»“æ„ä½“ç»‘å®šåˆ° <code>Fooer</code> æ¥å£ã€‚wire è¿˜ä¸ºæˆ‘ä»¬æä¾›äº†å¤‡ç”¨æ³¨å…¥å™¨è¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨ <code>panic</code> å–ä»£åœ¨ <code>injector</code> å‡½æ•°ä¸­ç¼–å†™è¿”å›å€¼ã€‚</p>
<p>wire çš„ç”¨æ³•éƒ½è®²è§£å®Œæˆä»¥åï¼Œæˆ‘åˆä»¥ä¸€ä¸ª <code>user</code> Web åº”ç”¨ä½œä¸ºæ¡ˆä¾‹ï¼Œä¸ºä½ è®²è§£äº†åœ¨ç”Ÿäº§å®è·µä¸­ wire çš„ä½¿ç”¨ã€‚</p>
<p>æ—¢ç„¶æˆ‘ä»¬å­¦ä¼šäº† wireï¼Œé‚£å°±åº”è¯¥çŸ¥é“æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦é€‰æ‹©ä½¿ç”¨ wireã€‚æˆ‘å¯¹æ¯”äº† Uber å¼€æºçš„ digï¼Œä»¥åŠ Facebook å¼€æºçš„ injectï¼Œä¸ºä½ è®²è§£äº†é€‰æ‹© wire çš„åŸå› ã€‚å¯ä»¥ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼šwire ä½¿ç”¨ä»£ç ç”Ÿæˆï¼Œè€Œéåå°„ã€‚</p>
<p>æœ€åï¼Œæˆ‘åˆç®€å•ä»‹ç»äº† <code>wire</code> å‘½ä»¤è¡Œå·¥å…·çš„ä½¿ç”¨ã€‚</p>
<p>è®°ä½ï¼Œä¾èµ–æ³¨å…¥å¹¶ä¸ç¥ç§˜ï¼Œwire çš„ä½œç”¨ä¹Ÿæ˜¾è€Œæ˜“è§ï¼Œå°±æ˜¯ä¸ºäº†è§£æ”¾åŒæ‰‹ã€‚å¦‚æœä½ æ›´å–œæ¬¢æ‰‹åŠ¨ç¼–å†™ä»£ç ï¼Œé‚£ä¹ˆä¹Ÿå®Œå…¨æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ä¸è¦è¿‡äºç¥åŒ–ä¾èµ–æ³¨å…¥å·¥å…·ï¼Œèµ·ç åœ¨ Go è¯­è¨€ä¸­æ˜¯è¿™æ ·ã€‚</p>
<p>æœ¬æ–‡ç¤ºä¾‹æºç æˆ‘éƒ½æ”¾åœ¨äº† <a href="https://github.com/jianghushinian/blog-go-example/tree/main/wire" target="_blank" rel="noopener">GitHub</a> ä¸­ï¼Œæ¬¢è¿ç‚¹å‡»æŸ¥çœ‹ã€‚</p>
<p>ç”±äºç¯‡å¹…æ‰€é™ï¼Œæœ‰äº›ç¤ºä¾‹æ–‡ç« ä¸­å¹¶æ²¡æœ‰ç»™å‡ºæ‰§è¡Œç»“æœï¼Œä½ ä¸€å®šè¦æŠŠæˆ‘çš„ç¤ºä¾‹ä»£ç  <code>clone</code> ä¸‹æ¥ï¼Œä¾æ¬¡æ‰§è¡Œä¸€éï¼Œè¿™æ ·æ‰èƒ½æ›´åŠ æ·±åˆ»çš„ç†è§£ã€‚</p>
<p>è‡³æ­¤æœ¬æ–‡å®Œç»“ï¼Œå¦‚æœä½ æƒ³è¦æ›´æ·±å…¥çš„äº†è§£ wireï¼Œé‚£å°±å»çœ‹å®ƒçš„<a href="https://github.com/google/wire" target="_blank" rel="noopener">æºç </a>å§ï¼Œç¥ä½ å¥½è¿ :)ã€‚</p>
<p>å¸Œæœ›æ­¤æ–‡èƒ½å¯¹ä½ æœ‰æ‰€å¯å‘ã€‚</p>
<p><strong>å»¶ä¼¸é˜…è¯»</strong></p>
<ul>
<li>Compile-time Dependency Injection With Go Cloudâ€™s Wire: <a href="https://go.dev/blog/wire" target="_blank" rel="noopener">https://go.dev/blog/wire</a></li>
<li>Wire README: <a href="https://github.com/google/wire/blob/main/README.md" target="_blank" rel="noopener">https://github.com/google/wire/blob/main/README.md</a></li>
<li>Wire Documentation: <a href="https://pkg.go.dev/github.com/google/wire/internal/wire" target="_blank" rel="noopener">https://pkg.go.dev/github.com/google/wire/internal/wire</a></li>
<li>Wire æºç : <a href="https://github.com/google/wire" target="_blank" rel="noopener">https://github.com/google/wire</a></li>
<li>onex usercenter: <a href="https://github.com/superproj/onex/tree/master/internal/usercenter" target="_blank" rel="noopener">https://github.com/superproj/onex/tree/master/internal/usercenter</a></li>
<li>Go Dependency Injection with Wire: <a href="https://blog.drewolson.org/go-dependency-injection-with-wire/" target="_blank" rel="noopener">https://blog.drewolson.org/go-dependency-injection-with-wire/</a></li>
<li>Golang Dependency Injection Using Wire: <a href="https://clavinjune.dev/en/blogs/golang-dependency-injection-using-wire/" target="_blank" rel="noopener">https://clavinjune.dev/en/blogs/golang-dependency-injection-using-wire/</a></li>
<li>Dependency Injection in Go using Wire: <a href="https://www.mohitkhare.com/blog/go-dependency-injection/" target="_blank" rel="noopener">https://www.mohitkhare.com/blog/go-dependency-injection/</a></li>
<li>Wire ä¾èµ–æ³¨å…¥: <a href="https://go-kratos.dev/docs/guide/wire/" target="_blank" rel="noopener">https://go-kratos.dev/docs/guide/wire/</a></li>
<li>Dependency Injection with Dig: <a href="https://www.jetbrains.com/guide/go/tutorials/dependency_injection_part_one/di_with_dig/" target="_blank" rel="noopener">https://www.jetbrains.com/guide/go/tutorials/dependency_injection_part_one/di_with_dig/</a></li>
<li>inject Documentation: <a href="https://pkg.go.dev/github.com/facebookgo/inject" target="_blank" rel="noopener">https://pkg.go.dev/github.com/facebookgo/inject</a></li>
<li>Build Constraints: <a href="https://pkg.go.dev/go/build#hdr-Build_Constraints" target="_blank" rel="noopener">https://pkg.go.dev/go/build#hdr-Build_Constraints</a></li>
<li>æ§åˆ¶åè½¬: <a href="https://zh.wikipedia.org/wiki/æ§åˆ¶åè½¬" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/æ§åˆ¶åè½¬</a></li>
<li>ä¾èµ–æ³¨å…¥: <a href="https://zh.wikipedia.org/wiki/ä¾èµ–æ³¨å…¥" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/ä¾èµ–æ³¨å…¥</a></li>
<li>SOLID (é¢å‘å¯¹è±¡è®¾è®¡): <a href="https://zh.wikipedia.org/wiki/SOLID_(é¢å‘å¯¹è±¡è®¾è®¡)" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/SOLID_(é¢å‘å¯¹è±¡è®¾è®¡)</a></li>
<li>è®¾è®¡æ¨¡å¼ä¹‹ç¾ â€”â€” 19 | ç†è®ºäº”ï¼šæ§åˆ¶åè½¬ã€ä¾èµ–åè½¬ã€ä¾èµ–æ³¨å…¥ï¼Œè¿™ä¸‰è€…æœ‰ä½•åŒºåˆ«å’Œè”ç³»ï¼Ÿ: <a href="https://time.geekbang.org/column/article/177444" target="_blank" rel="noopener">https://time.geekbang.org/column/article/177444</a></li>
<li>æœ¬æ–‡ GitHub ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/jianghushinian/blog-go-example/tree/main/wire" target="_blank" rel="noopener">https://github.com/jianghushinian/blog-go-example/tree/main/wire</a></li>
</ul>
<p><strong>è”ç³»æˆ‘</strong></p>
<ul>
<li>å…¬ä¼—å·ï¼š<a href="https://jianghushinian.cn/about" target="_blank" rel="noopener">Goç¼–ç¨‹ä¸–ç•Œ</a></li>
<li>å¾®ä¿¡ï¼šjianghushinian</li>
<li>é‚®ç®±ï¼š<a href="mailto:jianghushinian007@outlook.com">jianghushinian007@outlook.com</a></li>
<li>åšå®¢ï¼š<a href="https://jianghushinian.cn" target="_blank" rel="noopener">https://jianghushinian.cn</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2024-06-12T23:55:34.875Z" itemprop="dateUpdated">2024-06-13 07:55:34</time>
</span><br>


        
        <a href="/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/" target="_blank" rel="external">http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/</a>
        
    </div>
    
    <footer>
        <a href="http://www.jianghushinian.cn">
            <img src="/img/avatar.png" alt="æ±Ÿæ¹–åå¹´">
            æ±Ÿæ¹–åå¹´
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/" rel="tag">Go</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/&title=ã€Šåœ¨ Go ä¸­ï¼Œå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·æé«˜å¼€å‘æ•ˆç‡ï¼Ÿã€‹ â€” æ±Ÿæ¹–åå¹´&pic=http://www.jianghushinian.cn/img/avatar.png" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/&title=ã€Šåœ¨ Go ä¸­ï¼Œå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·æé«˜å¼€å‘æ•ˆç‡ï¼Ÿã€‹ â€” æ±Ÿæ¹–åå¹´&source=å¦‚æœä½ åšè¿‡ Java å¼€å‘ï¼Œé‚£ä¹ˆæƒ³å¿…ä¸€å®šå¬è¯´æˆ–ä½¿ç”¨è¿‡ä¾èµ–æ³¨å…¥ã€‚ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å°†ç»„ä»¶çš„ä¾èµ–é¡¹å¤–éƒ¨åŒ–ï¼Œä»è€Œä½¿ç»„ä»¶æœ¬èº«æ›´åŠ æ¨¡å—åŒ–å’Œå¯æµ‹è¯•ã€‚åœ¨..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šåœ¨ Go ä¸­ï¼Œå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·æé«˜å¼€å‘æ•ˆç‡ï¼Ÿã€‹ â€” æ±Ÿæ¹–åå¹´&url=http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/&via=http://www.jianghushinian.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2024/06/02/i-have-summarized-all-the-usages-of-empty-struct-in-go-for-you/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Go ä¸­ç©ºç»“æ„ä½“æƒ¯ç”¨æ³•ï¼Œæˆ‘å¸®ä½ æ€»ç»“å…¨äº†ï¼</h4>
      </a>
    </div>
  
</nav>



    


    <script src="/js/md5.min.js"></script>
    <section class="comments" id="comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = 'https-jianghushinian-cn';
            var disqus_identifier = location.pathname.slice(1,);
            var disqus_url = 'https://jianghushinian.cn/' + disqus_identifier;
            (function () {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the comments.</noscript>
    </section>


















</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        <span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        <span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>åšå®¢å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>æ±Ÿæ¹–åå¹´ &copy; 2019 - 2024</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/&title=ã€Šåœ¨ Go ä¸­ï¼Œå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·æé«˜å¼€å‘æ•ˆç‡ï¼Ÿã€‹ â€” æ±Ÿæ¹–åå¹´&pic=http://www.jianghushinian.cn/img/avatar.png" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/&title=ã€Šåœ¨ Go ä¸­ï¼Œå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·æé«˜å¼€å‘æ•ˆç‡ï¼Ÿã€‹ â€” æ±Ÿæ¹–åå¹´&source=å¦‚æœä½ åšè¿‡ Java å¼€å‘ï¼Œé‚£ä¹ˆæƒ³å¿…ä¸€å®šå¬è¯´æˆ–ä½¿ç”¨è¿‡ä¾èµ–æ³¨å…¥ã€‚ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å°†ç»„ä»¶çš„ä¾èµ–é¡¹å¤–éƒ¨åŒ–ï¼Œä»è€Œä½¿ç»„ä»¶æœ¬èº«æ›´åŠ æ¨¡å—åŒ–å’Œå¯æµ‹è¯•ã€‚åœ¨..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šåœ¨ Go ä¸­ï¼Œå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ wire ä¾èµ–æ³¨å…¥å·¥å…·æé«˜å¼€å‘æ•ˆç‡ï¼Ÿã€‹ â€” æ±Ÿæ¹–åå¹´&url=http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/&via=http://www.jianghushinian.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://www.jianghushinian.cn/2024/06/09/how-can-you-elegantly-use-dependency-injection-in-go-to-improve-development-efficiency/" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
