<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>用 Python 撸一个 Web 服务器-第4章：动态渲染数据 | 江湖十年 | 学而不思则罔，思而不学则殆。</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Python,Web">
    <meta name="description" content="上一章中为了尽快让 Todo List 程序跑起来，并没有完全按照 MVC 模式编写程序。这一章就让我们一起实现一个完整的 MVC 模式 Todo List 程序首页。">
<meta property="og:type" content="article">
<meta property="og:title" content="用 Python 撸一个 Web 服务器-第4章：动态渲染数据">
<meta property="og:url" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/index.html">
<meta property="og:site_name" content="江湖十年">
<meta property="og:description" content="上一章中为了尽快让 Todo List 程序跑起来，并没有完全按照 MVC 模式编写程序。这一章就让我们一起实现一个完整的 MVC 模式 Todo List 程序首页。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/Todo_List_Index_Use_Template.png">
<meta property="article:published_time" content="2020-07-17T13:17:42.000Z">
<meta property="article:modified_time" content="2022-12-24T13:16:45.406Z">
<meta property="article:author" content="江湖十年">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/Todo_List_Index_Use_Template.png">
    
        <link rel="alternate" type="application/atom+xml" title="江湖十年" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">江湖十年</h5>
          <a href="mailto:jianghushinian007@outlook.com" title="jianghushinian007@outlook.com" class="mail">jianghushinian007@outlook.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-link"></i>
                关于
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/jianghushinian" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">用 Python 撸一个 Web 服务器-第4章：动态渲染数据</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">用 Python 撸一个 Web 服务器-第4章：动态渲染数据</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-07-17T13:17:42.000Z" itemprop="datePublished" class="page-time">
  2020-07-17
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Web/">Web</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用模型操作数据"><span class="post-toc-number">1.</span> <span class="post-toc-text">使用模型操作数据</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用模板引擎渲染-HTML"><span class="post-toc-number">2.</span> <span class="post-toc-text">使用模板引擎渲染 HTML</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#MVC-模式的-Todo-List-程序首页"><span class="post-toc-number">3.</span> <span class="post-toc-text">MVC 模式的 Todo List 程序首页</span></a></li></ol>
        </nav>
    </aside>


<article id="post-用-Python-撸一个-Web-服务器-第4章：动态渲染数据"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">用 Python 撸一个 Web 服务器-第4章：动态渲染数据</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-07-17 21:17:42" datetime="2020-07-17T13:17:42.000Z"  itemprop="datePublished">2020-07-17</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Web/">Web</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>上一章中为了尽快让 Todo List 程序跑起来，并没有完全按照 <code>MVC</code> 模式编写程序。这一章就让我们一起实现一个完整的 <code>MVC</code> 模式 Todo List 程序首页。</p>
<a id="more"></a>

<h3 id="使用模型操作数据"><a href="#使用模型操作数据" class="headerlink" title="使用模型操作数据"></a>使用模型操作数据</h3><p>我们来分析下请求 Todo List 程序首页时，模型层需要做哪些事情。当一个请求到达首页视图函数 <code>index</code> 时，它需要做两件事情，首先调用模型层获取全部的 todo 数据，然后将 todo 数据动态填充到 <code>index.html</code> 模板中。</p>
<p>调用模型层获取全部的 todo 数据，只需要在模型层编写读取 <code>todo/db/todo.json</code> 文件数据的代码即可。在这之前，我们需要先确定 todo 在文件中存储的格式。</p>
<p>Todo List 程序中 todo 需要存储的数据只有一个，就是 todo 的内容。所以我们可以将 todo 以如下格式存储到 <code>todo/db/todo.json</code> 文件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// todo_list/todo/db/todo.json</span></span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"content"</span>: <span class="string">"hello world"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"content"</span>: <span class="string">"你好，世界！"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>这是一个标准的 <code>JSON</code> 格式，每一个对象代表了一条 todo，<code>content</code> 字段即为 todo 内容，<code>id</code> 作为每条数据的索引不会展示在页面中，方便我们对数据进行排序、快速查找等操作。 </p>
<p>为了简化程序，我将数据存储在 <code>JSON</code> 文件中而不是数据库中。存储到文件的格式多种多样，但 <code>JSON</code> 格式是一种非常流行且友好的数据格式，在 Python 中也能够很方便的对 <code>JSON</code> 格式的文件进行读写操作。</p>
<p>注意：</p>
<ol>
<li><code>JSON</code> 文件不支持注释，所以如果你打算直接从上面示例中复制数据到 <code>todo.json</code> 文件时，需要去掉顶部文件名注释。</li>
<li>如果 <code>todo/db/todo.json</code> 文件内容为空，使用 Python 读取时会抛出 <code>JSONDecodeError</code> 异常，起码要保证其内部有一个空数组 <code>[]</code> 存在，才能正常读取。</li>
</ol>
<p>确定了 <code>todo/db/todo.json</code> 文件数据格式，就可以编写在模型层读取 todo 数据的代码了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo_list/todo/models.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> todo.config <span class="keyword">import</span> BASE_DIR</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Todo 模型类</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        self.id = kwargs.get(<span class="string">'id'</span>)</span><br><span class="line">        self.content = kwargs.get(<span class="string">'content'</span>, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_db_path</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="string">"""获取存储 todo 数据文件的绝对路径"""</span></span><br><span class="line">        <span class="comment"># 返回 'todo_list/todo/db/todo.json' 文件的绝对路径</span></span><br><span class="line">        path = os.path.join(BASE_DIR, <span class="string">'db/todo.json'</span>)</span><br><span class="line">        <span class="keyword">return</span> path</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_load_db</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="string">"""加载 JSON 文件中所有 todo 数据"""</span></span><br><span class="line">        path = cls._db_path()</span><br><span class="line">        <span class="keyword">with</span> open(path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">return</span> json.load(f)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all</span><span class="params">(cls, sort=False, reverse=False)</span>:</span></span><br><span class="line">        <span class="string">"""获取全部 todo"""</span></span><br><span class="line">        <span class="comment"># 这一步用来将所有从 JSON 文件中读取的 todo 数据转换为 Todo 实例化对象，方便后续操作</span></span><br><span class="line">        todo_list = [cls(**todo_dict) <span class="keyword">for</span> todo_dict <span class="keyword">in</span> cls._load_db()]</span><br><span class="line">        <span class="comment"># 对数据按照 id 进行排序</span></span><br><span class="line">        <span class="keyword">if</span> sort:</span><br><span class="line">            todo_list = sorted(todo_list, key=<span class="keyword">lambda</span> x: x.id, reverse=reverse)</span><br><span class="line">        <span class="keyword">return</span> todo_list</span><br></pre></td></tr></table></figure>

<p>定义 <code>Todo</code> 模型类来操作 todo 数据。<code>Todo</code> 模型类的 <code>all</code> 方法用来读取全部的 todo 数据，在其内部将所有从 <code>JSON</code> 文件中读取的 todo 数据转换为 <code>Todo</code> 实例化对象并组装成 <code>list</code> 返回。<code>all</code> 方法还可以对数据进行排序，排序操作实际上转发给了 Python 内置的 <code>sorted</code> 函数来完成。</p>
<p>有了全部的 todo 数据，下一步操作就是将 todo 数据动态填充到 <code>todo/templates/index.html</code> 模板中。</p>
<h3 id="使用模板引擎渲染-HTML"><a href="#使用模板引擎渲染-HTML" class="headerlink" title="使用模板引擎渲染 HTML"></a>使用模板引擎渲染 HTML</h3><p>上一章实现的 Todo List 程序返回的首页数据都是固定写死在 <code>todo/templates/index.html</code> 代码中的。现在需要动态填充 todo 内容，我们需要学习一个新的概念叫作 <code>模板渲染</code>。</p>
<p>首先我们编写的 HTML 页面不再是完全使用 HTML 的标签来编写，而需要使用一些占位变量来替换需要动态填充的部分，这样编写出来的 HTML 页面通常称为模板。将 HTML 模板读取到内存中，使用真实的 todo 数据来替换掉占位变量而获得最终将要返回的字符串数据，这个过程称为渲染。能够实现读取 HTML 中的占位变量并正确替换为真实值的代码称为模板引擎。</p>
<p>Todo List 程序首页主体部分代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span>Todo List<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>你好，世界！<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中每一个 <code>li</code> 标签代表一条 todo，显然 todo 的条数是不确定的，所以每一个 <code>li</code> 标签都需要动态生成。根据这段 HTML 代码，可以编写出如下模板：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span>Todo List<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for todo in todo_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; todo.content &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这段模板代码中只保留了一对 <code>li</code> 标签，它被嵌套在 <code>for</code> 循环中，<code>for</code> 语句块从 <code></code>  结束。<code>todo_list</code> 变量是在模板渲染阶段传进来的由所有 todo 对象组成的 <code>list</code>，<code>list</code> 中有多少个元素就会渲染多少个 <code>li</code> 标签。<code>for</code> 循环内部使用了循环变量 <code>todo</code>，<code></code> 表示获取 <code>todo</code> 变量的 <code>content</code> 属性，这与 Python 中获取对象的属性语法相同。</p>
<p>了解了模板语法，我们还需要有一个能够读懂模板语法的模板引擎。Todo List 程序的 HTML 模板只会用到 <code>for</code> 循环和模板变量这两种语法，所以我们将要实现的模板引擎只需要能够解析这两种语法即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo_list/todo/utils.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Template</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""模板引擎"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, text, context)</span>:</span></span><br><span class="line">        <span class="comment"># 保存最终结果</span></span><br><span class="line">        self.result = []</span><br><span class="line">        <span class="comment"># 保存从 HTML 中解析出来的 for 语句代码片段</span></span><br><span class="line">        self.for_snippet = []</span><br><span class="line">        <span class="comment"># 上下文变量</span></span><br><span class="line">        self.context = context</span><br><span class="line">        <span class="comment"># 使用正则匹配出所有的 for 语句、模板变量</span></span><br><span class="line">        self.snippets = re.split(<span class="string">'(&#123;&#123;.*?&#125;&#125;|&#123;%.*?%&#125;)'</span>, text, flags=re.DOTALL)</span><br><span class="line">        <span class="comment"># 标记是否为 for 语句代码段</span></span><br><span class="line">        is_for_snippet = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 遍历所有匹配出来的代码片段</span></span><br><span class="line">        <span class="keyword">for</span> snippet <span class="keyword">in</span> self.snippets:</span><br><span class="line">            <span class="comment"># 解析模板变量</span></span><br><span class="line">            <span class="keyword">if</span> snippet.startswith(<span class="string">'&#123;&#123;'</span>):</span><br><span class="line">                <span class="keyword">if</span> is_for_snippet <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">                    <span class="comment"># 去掉花括号和空格，获取变量名</span></span><br><span class="line">                    var = snippet[<span class="number">2</span>:<span class="number">-2</span>].strip()</span><br><span class="line">                    <span class="comment"># 获取变量的值</span></span><br><span class="line">                    snippet = self._get_var_value(var)</span><br><span class="line">            <span class="comment"># 解析 for 语句</span></span><br><span class="line">            <span class="keyword">elif</span> snippet.startswith(<span class="string">'&#123;%'</span>):</span><br><span class="line">                <span class="comment"># for 语句开始代码片段 -&gt; &#123;% for todo in todo_list %&#125;</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">'in'</span> <span class="keyword">in</span> snippet:</span><br><span class="line">                    is_for_snippet = <span class="literal">True</span></span><br><span class="line">                    self.result.append(<span class="string">'&#123;&#125;'</span>)</span><br><span class="line">                <span class="comment"># for 语句结束代码片段 -&gt; &#123;% endfor %&#125;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    is_for_snippet = <span class="literal">False</span></span><br><span class="line">                    snippet = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> is_for_snippet:</span><br><span class="line">                <span class="comment"># 如果是 for 语句代码段，需要进行二次处理，暂时保存到 for 语句片段列表中</span></span><br><span class="line">                self.for_snippet.append(snippet)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 如果是模板变量，直接将变量值追加到结果列表中</span></span><br><span class="line">                self.result.append(snippet)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_var_value</span><span class="params">(self, var)</span>:</span></span><br><span class="line">        <span class="string">"""根据变量名获取变量的值"""</span></span><br><span class="line">        <span class="comment"># 如果 '.' 不在变量名中，直接在上下文变量中获取变量的值</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'.'</span> <span class="keyword">not</span> <span class="keyword">in</span> var:</span><br><span class="line">            value = self.context.get(var)</span><br><span class="line">        <span class="comment"># '.' 在变量名中（对象.属性），说明是要获取对象的属性</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            obj, attr = var.split(<span class="string">'.'</span>)</span><br><span class="line">            value = getattr(self.context.get(obj), attr)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 保证返回的变量值为字符串</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, str):</span><br><span class="line">            value = str(value)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_parse_for_snippet</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""解析 for 语句片段代码"""</span></span><br><span class="line">        <span class="comment"># 保存 for 语句片段解析结果</span></span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">if</span> self.for_snippet:</span><br><span class="line">            <span class="comment"># 解析 for 语句开始代码片段</span></span><br><span class="line">            <span class="comment"># '&#123;% for todo in todo_list %&#125;' -&gt; ['for', 'todo', 'in', 'todo_list']</span></span><br><span class="line">            words = self.for_snippet[<span class="number">0</span>][<span class="number">2</span>:<span class="number">-2</span>].strip().split()</span><br><span class="line">            <span class="comment"># 从上下文变量中获取 for 语句中的可迭代对象</span></span><br><span class="line">            iter_obj = self.context.get(words[<span class="number">-1</span>])</span><br><span class="line">            <span class="comment"># 遍历可迭代对象</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> iter_obj:</span><br><span class="line">                <span class="comment"># 遍历 for 语句片段的代码块</span></span><br><span class="line">                <span class="keyword">for</span> snippet <span class="keyword">in</span> self.for_snippet[<span class="number">1</span>:]:</span><br><span class="line">                    <span class="comment"># 解析模板变量</span></span><br><span class="line">                    <span class="keyword">if</span> snippet.startswith(<span class="string">'&#123;&#123;'</span>):</span><br><span class="line">                        <span class="comment"># 去掉花括号和空格，获取变量名</span></span><br><span class="line">                        var = snippet[<span class="number">2</span>:<span class="number">-2</span>].strip()</span><br><span class="line">                        <span class="comment"># 如果 '.' 不在变量名中，直接将循环变量 i 赋值给 snippet</span></span><br><span class="line">                        <span class="keyword">if</span> <span class="string">'.'</span> <span class="keyword">not</span> <span class="keyword">in</span> var:</span><br><span class="line">                            snippet = i</span><br><span class="line">                        <span class="comment"># '.' 在变量名中（对象.属性），说明是要获取对象的属性</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            obj, attr = var.split(<span class="string">'.'</span>)</span><br><span class="line">                            <span class="comment"># 将对象的属性值赋值给 snippet</span></span><br><span class="line">                            snippet = getattr(i, attr)</span><br><span class="line">                    <span class="comment"># 保证变量值为字符串</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(snippet, str):</span><br><span class="line">                        snippet = str(snippet)</span><br><span class="line">                    <span class="comment"># 将解析出来的循环变量结果追加到 for 语句片段解析结果列表中</span></span><br><span class="line">                    result.append(snippet)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""渲染"""</span></span><br><span class="line">        <span class="comment"># 获取 for 语句片段解析结果</span></span><br><span class="line">        for_result = self._parse_for_snippet()</span><br><span class="line">        <span class="comment"># 将渲染结果组装成字符串并返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(self.result).format(<span class="string">''</span>.join(for_result))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_template</span><span class="params">(template, **context)</span>:</span></span><br><span class="line">    <span class="string">"""渲染模板"""</span></span><br><span class="line">    <span class="comment"># 读取 'todo_list/todo/templates' 目录下的 HTML 文件内容</span></span><br><span class="line">    template_dir = os.path.join(BASE_DIR, <span class="string">'templates'</span>)</span><br><span class="line">    path = os.path.join(template_dir, template)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># 将从 HTML 中读取的内容传递给模板引擎</span></span><br><span class="line">        t = Template(f.read(), context)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 调用模板引擎的渲染方法，实现模板渲染</span></span><br><span class="line">    <span class="keyword">return</span> t.render()</span><br></pre></td></tr></table></figure>

<p><code>Template</code> 类就是我们为 Todo List 程序实现的模板引擎。模板引擎的代码有些复杂，我写了比较详细的注释来帮助你理解。模板渲染的大概过程如下：</p>
<p>首先实例化 <code>Template</code> 对象，<code>Template</code> 对象的初始化方法 <code>__init__</code> 需要传递两个参数，分别是 HTML 字符串和保存了模板所需变量的 <code>dict</code>，在初始化时会解析出 HTML 中所有的 <code>for</code> 语句和模板变量，模板变量直接被替换为对应的值，<code>for</code> 语句代码段则被暂存起来，等到需要真正渲染模板时，调用模板引擎实例对象的 <code>render</code> 方法，完成 <code>for</code> 语句的解析和值替换，最终将渲染结果组装成字符串并返回。</p>
<p><code>render_template</code> 函数的代码也做了相应的调整，它的功能不再只是读取 HTML 内容，而是需要在内部调用模板引擎获取渲染结果。</p>
<p>对于基础薄弱的读者来说可能模板引擎部分的代码不太好理解，那么暂时先不必深究，你只需要知道模板引擎干了什么，明白它的原理无非是将 HTML 字符串中的模板语法全部找出来，然后根据语法规则将其替换成真正的变量值，最后渲染成正确的 HTML。本质上还是字符串的拼接，就像 Python 字符串的 <code>format</code> 方法一样，它能够找到字符串中的花括号 <code>{}</code>，然后替换成传递给它的参数值。</p>
<h3 id="MVC-模式的-Todo-List-程序首页"><a href="#MVC-模式的-Todo-List-程序首页" class="headerlink" title="MVC 模式的 Todo List 程序首页"></a>MVC 模式的 Todo List 程序首页</h3><p>我们已经介绍了使用模型操作数据和使用模板引擎渲染 HTML，现在就可以用动态渲染的 HTML 首页替换之前的静态首页了。</p>
<p>修改首页 <code>todo/templates/index.html</code> 的 HTML 代码为一个模板：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- todo_list/todo/templates/index.html --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Todo List<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span>Todo List<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for todo in todo_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; todo.content &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里我暂时去掉了 HTML 顶部的 CSS 样式，因为我们的模板引擎不支持这种直接将 CSS 嵌入在 HTML 中的写法，之后我会介绍如何通过 <code>link</code> 标签来引入外部样式。</p>
<p>我们还要对 <code>index</code> 视图函数做些修改，在视图函数内部调用 <code>Todo</code> 模型的 <code>all</code> 方法来获取所有 todo，然后传递给模板引擎对 HTML 进行渲染，得到最终结果。修改后的代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo_list/todo/controllers.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> todo.utils <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> todo.models <span class="keyword">import</span> Todo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""首页视图函数"""</span></span><br><span class="line">    <span class="comment"># 倒序排序，最近添加的 todo 排在前面</span></span><br><span class="line">    todo_list = Todo.all(sort=<span class="literal">True</span>, reverse=<span class="literal">True</span>)</span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">'todo_list'</span>: todo_list,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, **context)</span><br></pre></td></tr></table></figure>

<p>在终端中进入项目根目录 <code>todo_list/</code> 下，使用 Python 运行 <code>server.py</code> 文件，将得到经过动态渲染的 Todo List 程序首页：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="Todo_List_Index_Use_Template.png" alt="Todo List 首页" title="">
                </div>
                <div class="image-caption">Todo List 首页</div>
            </figure>

<p>现在 Todo List 程序首页已经是动态渲染的了，下一章我们就来解决样式问题。</p>
<blockquote>
<p>本章源码：<a href="https://github.com/jianghushinian/todo-list/tree/master/chapter4" target="_blank" rel="noopener">chapter4</a></p>
</blockquote>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2022-12-24T13:16:45.406Z" itemprop="dateUpdated">2022-12-24 21:16:45</time>
</span><br>


        
        <a href="/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/" target="_blank" rel="external">http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/</a>
        
    </div>
    
    <footer>
        <a href="http://www.jianghushinian.cn">
            <img src="/img/avatar.png" alt="江湖十年">
            江湖十年
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/" rel="tag">Web</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/&title=《用 Python 撸一个 Web 服务器-第4章：动态渲染数据》 — 江湖十年&pic=http://www.jianghushinian.cn/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/&title=《用 Python 撸一个 Web 服务器-第4章：动态渲染数据》 — 江湖十年&source=上一章中为了尽快让 Todo List 程序跑起来，并没有完全按照 MVC 模式编写程序。这一章就让我们一起实现一个完整的 MVC 模式 Todo Lis..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《用 Python 撸一个 Web 服务器-第4章：动态渲染数据》 — 江湖十年&url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/&via=http://www.jianghushinian.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC5%E7%AB%A0%EF%BC%9A%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">用 Python 撸一个 Web 服务器-第5章：处理静态资源</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC3%E7%AB%A0%EF%BC%9A%E4%BD%BF%E7%94%A8-MVC-%E6%9E%84%E5%BB%BA%E7%A8%8B%E5%BA%8F/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">用 Python 撸一个 Web 服务器-第3章：使用 MVC 构建程序</h4>
      </a>
    </div>
  
</nav>



    








<section class="comments" id="comments">
    <div id="gitment_thread"></div>
    <link rel="stylesheet" href="//unpkg.com/gitment/style/default.css">
    <script src="//unpkg.com/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            owner: 'jianghushinian',
            repo: 'jianghushinian.github.io',
            oauth: {
                client_id: '9d22aca5e6d2962ef86e',
                client_secret: '4a93d756cc14be84e76817cacbf8533fe424f1ae',
            },
        })
        gitment.render('comments')
    </script>
</section>













</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        <span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        <span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>江湖十年 &copy; 2019 - 2022</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/&title=《用 Python 撸一个 Web 服务器-第4章：动态渲染数据》 — 江湖十年&pic=http://www.jianghushinian.cn/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/&title=《用 Python 撸一个 Web 服务器-第4章：动态渲染数据》 — 江湖十年&source=上一章中为了尽快让 Todo List 程序跑起来，并没有完全按照 MVC 模式编写程序。这一章就让我们一起实现一个完整的 MVC 模式 Todo Lis..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《用 Python 撸一个 Web 服务器-第4章：动态渲染数据》 — 江湖十年&url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/&via=http://www.jianghushinian.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
