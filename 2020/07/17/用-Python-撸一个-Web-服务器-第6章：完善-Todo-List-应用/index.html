<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>用 Python 撸一个 Web 服务器-第6章：完善 Todo List 应用 | 江湖十年 | 学而不思则罔，思而不学则殆。</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Python,Web">
    <meta name="description" content="这一章，我们来完成 todo 管理功能的剩余部分：新增、修改和删除功能。">
<meta property="og:type" content="article">
<meta property="og:title" content="用 Python 撸一个 Web 服务器-第6章：完善 Todo List 应用">
<meta property="og:url" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/index.html">
<meta property="og:site_name" content="江湖十年">
<meta property="og:description" content="这一章，我们来完成 todo 管理功能的剩余部分：新增、修改和删除功能。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/Todo_List_Index_new.png">
<meta property="og:image" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/Todo_List_new_required.png">
<meta property="og:image" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/Todo_List_new_todo.png">
<meta property="og:image" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/Todo_List_new_todo_after.png">
<meta property="og:image" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/Todo_List_edit_todo_before.png">
<meta property="og:image" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/Todo_List_edit_todo.png">
<meta property="og:image" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/Todo_List_edit_todo_after.png">
<meta property="og:image" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/Todo_List_delete_todo.png">
<meta property="og:image" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/Todo_List_delete_after_todo.png">
<meta property="article:published_time" content="2020-07-17T13:25:42.000Z">
<meta property="article:modified_time" content="2022-12-24T13:16:45.407Z">
<meta property="article:author" content="江湖十年">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/Todo_List_Index_new.png">
    
        <link rel="alternate" type="application/atom+xml" title="江湖十年" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">江湖十年</h5>
          <a href="mailto:jianghushinian007@outlook.com" title="jianghushinian007@outlook.com" class="mail">jianghushinian007@outlook.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-link"></i>
                关于
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/jianghushinian" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">用 Python 撸一个 Web 服务器-第6章：完善 Todo List 应用</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">用 Python 撸一个 Web 服务器-第6章：完善 Todo List 应用</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-07-17T13:25:42.000Z" itemprop="datePublished" class="page-time">
  2020-07-17
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Web/">Web</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#新增-todo"><span class="post-toc-number">1.</span> <span class="post-toc-text">新增 todo</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#修改-todo"><span class="post-toc-number">2.</span> <span class="post-toc-text">修改 todo</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#删除-todo"><span class="post-toc-number">3.</span> <span class="post-toc-text">删除 todo</span></a></li></ol>
        </nav>
    </aside>


<article id="post-用-Python-撸一个-Web-服务器-第6章：完善-Todo-List-应用"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">用 Python 撸一个 Web 服务器-第6章：完善 Todo List 应用</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-07-17 21:25:42" datetime="2020-07-17T13:25:42.000Z"  itemprop="datePublished">2020-07-17</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Web/">Web</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>这一章，我们来完成 todo 管理功能的剩余部分：新增、修改和删除功能。</p>
<a id="more"></a>

<h3 id="新增-todo"><a href="#新增-todo" class="headerlink" title="新增 todo"></a>新增 todo</h3><p>首先实现 Todo List 程序的新增功能。新增 todo 的逻辑如下：</p>
<ol>
<li>在首页顶部的输入框中输入 todo 内容。</li>
<li>然后点击新建按钮。</li>
<li>将输入框中的 todo 内容通过 <code>POST</code> 请求传递到服务器端。</li>
<li>服务器端解析请求中的 todo 内容并存储到文件。</li>
<li>重新返回到程序首页。</li>
</ol>
<p>接下来对这些步骤进行具体实现。</p>
<p>首页 HTML 中添加新增 todo 的输入框和新建按钮：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- todo_list/todo/templates/index.html --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Todo List<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入外部 CSS 样式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/css/style.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span>Todo List<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"new"</span> <span class="attr">action</span>=<span class="string">"/new"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"save"</span>&gt;</span>新建<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        &#123;% for todo in todo_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; todo.content &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>代码中增加了一个 <code>form</code> 标签，用来新增 todo。请求路径地址为 <code>/new</code>，请求方法为 <code>post</code>。</p>
<p>将首页的 CSS 代码追加到 <code>style.css</code> 文件中：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* todo_list/todo/static/css/style.css */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span><span class="selector-pseudo">:first-child</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">28px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.new</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">600px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">form</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时首页效果如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="Todo_List_Index_new.png" alt="Todo List 首页" title="">
                </div>
                <div class="image-caption">Todo List 首页</div>
            </figure>

<p>修改 <code>Request</code> 类，使其能够解析 <code>GET</code>、<code>POST</code> 请求中携带的参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo_list/todo/utils.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote_plus</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""请求类"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, request_message)</span>:</span></span><br><span class="line">        method, path, headers, args, form = self.parse_data(request_message)</span><br><span class="line">        self.method = method  <span class="comment"># 请求方法 GET、POST</span></span><br><span class="line">        self.path = path  <span class="comment"># 请求路径 /index</span></span><br><span class="line">        self.headers = headers  <span class="comment"># 请求头 &#123;'Host': '127.0.0.1:8000'&#125;</span></span><br><span class="line">        self.args = args  <span class="comment"># 查询参数</span></span><br><span class="line">        self.form = form  <span class="comment"># 请求体</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_data</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="string">"""解析请求数据"""</span></span><br><span class="line">        <span class="comment"># 用请求报文中的第一个 '\r\n\r\n' 做分割，将得到请求头和请求体</span></span><br><span class="line">        header, body = data.split(<span class="string">'\r\n\r\n'</span>, <span class="number">1</span>)</span><br><span class="line">        method, path, headers, args = self._parse_header(header)</span><br><span class="line">        form = self._path_body(body)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> method, path, headers, args, form</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_parse_header</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="string">"""解析请求头"""</span></span><br><span class="line">        <span class="comment"># 拆分请求行和请求首部</span></span><br><span class="line">        request_line, request_header = data.split(<span class="string">'\r\n'</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 请求行拆包 'GET /index HTTP/1.1' -&gt; ['GET', '/index', 'HTTP/1.1']</span></span><br><span class="line">        <span class="comment"># 因为 HTTP 版本号没什么用，所以用一个下划线 _ 变量来接收</span></span><br><span class="line">        method, path_query, _ = request_line.split()</span><br><span class="line">        path, args = self._parse_path(path_query)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 解析请求首部所有的键值对，组装成字典</span></span><br><span class="line">        headers = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> header <span class="keyword">in</span> request_header.split(<span class="string">'\r\n'</span>):</span><br><span class="line">            k, v = header.split(<span class="string">': '</span>, <span class="number">1</span>)</span><br><span class="line">            headers[k] = v</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> method, path, headers, args</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_parse_path</span><span class="params">(data)</span>:</span></span><br><span class="line">        <span class="string">"""解析请求路径、请求参数"""</span></span><br><span class="line">        args = &#123;&#125;</span><br><span class="line">        <span class="comment"># 请求路径和 GET 请求参数格式: /index?edit=1&amp;content=text</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'?'</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">            path, query = data, <span class="string">''</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            path, query = data.split(<span class="string">'?'</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">for</span> q <span class="keyword">in</span> query.split(<span class="string">'&amp;'</span>):</span><br><span class="line">                k, v = q.split(<span class="string">'='</span>, <span class="number">1</span>)</span><br><span class="line">                args[k] = v</span><br><span class="line">        <span class="keyword">return</span> path, args</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_path_body</span><span class="params">(data)</span>:</span></span><br><span class="line">        <span class="string">"""解析请求体"""</span></span><br><span class="line">        form = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> data:</span><br><span class="line">            <span class="comment"># POST 请求体参数格式: username=zhangsan&amp;password=mima</span></span><br><span class="line">            <span class="keyword">for</span> b <span class="keyword">in</span> data.split(<span class="string">'&amp;'</span>):</span><br><span class="line">                k, v = b.split(<span class="string">'='</span>, <span class="number">1</span>)</span><br><span class="line">                <span class="comment"># 前端页面中通过 form 表单提交过来的数据会被自动编码，使用 unquote_plus 来解码</span></span><br><span class="line">                form[k] = unquote_plus(v)</span><br><span class="line">        <span class="keyword">return</span> form</span><br></pre></td></tr></table></figure>

<p>为 <code>Request</code> 类新增了两个静态方法，<code>_parse_path</code> 方法用来拆分请求路径和请求参数。<code>_path_body</code> 用来提取请求体中的参数并转换为 <code>dict</code>。</p>
<p>在服务器端将新增的 todo 内存保存到文件后，程序需要重新回到首页。所以我们需要定义一个重定向函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo_list/todo/utils.py</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redirect</span><span class="params">(url, status=<span class="number">302</span>)</span>:</span></span><br><span class="line">    <span class="string">"""重定向"""</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'Location'</span>: url,</span><br><span class="line">    &#125;</span><br><span class="line">    body = <span class="string">''</span></span><br><span class="line">    <span class="keyword">return</span> Response(body, headers=headers, status=status)</span><br></pre></td></tr></table></figure>

<p>重定向原理大致如下：</p>
<p>浏览器收到服务端的响应，如果状态码为 <code>3XX</code>，则表示重定向，浏览器会解析出响应头中的 <code>Location</code> 首部字段的值，然后通过 GET 请求方式访问这个 <code>URL</code> 地址。</p>
<p>重定向状态码最常见的两个就是 <code>301</code>、<code>302</code>，<code>301</code> 代表永久重定向，<code>302</code> 代表临时重定向。我们项目适合使用临时重定向，所以 <code>redirect</code> 函数的 <code>status</code> 参数默认值为 <code>302</code>。</p>
<p>同时还需要修改 <code>Response</code> 响应类，使其能够处理 <code>302</code> 状态码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo_list/todo/utils.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Response</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""响应类"""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据状态码获取原因短语</span></span><br><span class="line">    reason_phrase = &#123;</span><br><span class="line">        <span class="number">200</span>: <span class="string">'OK'</span>,</span><br><span class="line">        <span class="number">302</span>: <span class="string">'FOUND'</span>,</span><br><span class="line">        <span class="number">405</span>: <span class="string">'METHOD NOT ALLOWED'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>在模型层，给 <code>Todo</code> 模型类新增一个 <code>save</code> 实例方法用来保存 todo 对象到文件中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo_list/todo/models.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> todo.config <span class="keyword">import</span> BASE_DIR</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Todo 模型类</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        self.id = kwargs.get(<span class="string">'id'</span>)</span><br><span class="line">        self.content = kwargs.get(<span class="string">'content'</span>, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_db_path</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="string">"""获取存储 todo 数据文件的绝对路径"""</span></span><br><span class="line">        <span class="comment"># 返回 'todo_list/todo/db/todo.json' 文件的绝对路径</span></span><br><span class="line">        path = os.path.join(BASE_DIR, <span class="string">'db/todo.json'</span>)</span><br><span class="line">        <span class="keyword">return</span> path</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_load_db</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="string">"""加载 JSON 文件中所有 todo 数据"""</span></span><br><span class="line">        path = cls._db_path()</span><br><span class="line">        <span class="keyword">with</span> open(path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">return</span> json.load(f)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_save_db</span><span class="params">(cls, data)</span>:</span></span><br><span class="line">        <span class="string">"""将 todo 数据保存到 JSON 文件"""</span></span><br><span class="line">        path = cls._db_path()</span><br><span class="line">        <span class="keyword">with</span> open(path, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(data, f, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all</span><span class="params">(cls, sort=False, reverse=False)</span>:</span></span><br><span class="line">        <span class="string">"""获取全部 todo"""</span></span><br><span class="line">        <span class="comment"># 这一步用来将所有从 JSON 文件中读取的 todo 数据转换为 Todo 实例化对象，方便后续操作</span></span><br><span class="line">        todo_list = [cls(**todo_dict) <span class="keyword">for</span> todo_dict <span class="keyword">in</span> cls._load_db()]</span><br><span class="line">        <span class="comment"># 对数据按照 id 排序</span></span><br><span class="line">        <span class="keyword">if</span> sort:</span><br><span class="line">            todo_list = sorted(todo_list, key=<span class="keyword">lambda</span> x: x.id, reverse=reverse)</span><br><span class="line">        <span class="keyword">return</span> todo_list</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""保存 todo"""</span></span><br><span class="line">        <span class="comment"># 查找出除 self 以外所有 todo</span></span><br><span class="line">        <span class="comment"># todo.__dict__ 是保存了所有实例属性的字典</span></span><br><span class="line">        todo_list = [todo.__dict__ <span class="keyword">for</span> todo <span class="keyword">in</span> self.all(sort=<span class="literal">True</span>) <span class="keyword">if</span> todo.id != self.id]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 自增 id</span></span><br><span class="line">        <span class="keyword">if</span> self.id <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 如果 todo_list 长度大于 0 说明不是第一条 todo，取最后一条 todo 的 id 加 1</span></span><br><span class="line">            <span class="keyword">if</span> len(todo_list) &gt; <span class="number">0</span>:</span><br><span class="line">                self.id = todo_list[<span class="number">-1</span>][<span class="string">'id'</span>] + <span class="number">1</span></span><br><span class="line">            <span class="comment"># 否则说明是第一条 todo，id 为 1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.id = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将当前 todo 追加到 todo_list</span></span><br><span class="line">        todo_list.append(self.__dict__)</span><br><span class="line">        <span class="comment"># 将所有 todo 保存到文件</span></span><br><span class="line">        self._save_db(todo_list)</span><br></pre></td></tr></table></figure>

<p>在控制器层，编写一个 <code>new</code> 视图函数用来处理新增 todo 的业务逻辑：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo_list/todo/controllers.py</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="string">"""新建 todo 视图函数"""</span></span><br><span class="line">    form = request.form</span><br><span class="line">    print(<span class="string">f'form: <span class="subst">&#123;form&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    content = form.get(<span class="string">'content'</span>)</span><br><span class="line">    <span class="comment"># 这里判断前端传递过来的参数是否有内容，如果为空则说明不是一个有效的 todo，直接重定向到首页</span></span><br><span class="line">    <span class="keyword">if</span> content:</span><br><span class="line">        todo = Todo(content=content)</span><br><span class="line">        todo.save()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/index'</span>)</span><br></pre></td></tr></table></figure>

<p>在 <code>new</code> 视图函数中判断如果前端传递过来的 todo 有效，就将其保存到文件，然后重定向到首页。</p>
<p>其实对于检查 todo 是否有效的逻辑前端也可以处理，只需要在输入 todo 的 <code>input</code> 标签加上 <code>required</code> 属性即可。这样当用户未输入任何内容就直接点击新建按钮时，浏览器会自动给出 <code>请填写此字段。</code> 的提示，在浏览器端做校验的好处是可以在请求未发送给后台服务器之前，由浏览器自动完成输入校验，这样能够减少发送请求的次数，避免无效的请求发送到服务器后台造成资源的浪费。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"new"</span> <span class="attr">action</span>=<span class="string">"/new"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"content"</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"save"</span>&gt;</span>新建<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="Todo_List_new_required.png" alt="input rquired" title="">
                </div>
                <div class="image-caption">input rquired</div>
            </figure>

<p>现在就可以使用 Todo List 程序的新增功能来添加 todo 了：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="Todo_List_new_todo.png" alt="新增 todo" title="">
                </div>
                <div class="image-caption">新增 todo</div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="Todo_List_new_todo_after.png" alt="新增 todo" title="">
                </div>
                <div class="image-caption">新增 todo</div>
            </figure>

<h3 id="修改-todo"><a href="#修改-todo" class="headerlink" title="修改 todo"></a>修改 todo</h3><p>修改 todo 的逻辑如下：</p>
<ol>
<li>点击首页中想要修改的 todo 右侧的编辑按钮。</li>
<li>页面跳转到编辑页面。</li>
<li>修改这条 todo 内容，点击保存按钮。</li>
<li>将输入框中的 todo 内容通过 <code>POST</code> 请求传递到服务器端。</li>
<li>服务器端将修改后的 todo 保存到文件。</li>
<li>重新返回到程序首页。</li>
</ol>
<p>需要注意的是，修改 todo 依然采用了 <code>POST</code> 请求方式来提交数据。在前面介绍 HTTP 请求方法时，我提到过 HTTP 常见请求方法有四个：<code>POST</code>、<code>DELETE</code>、<code>PUT</code>、<code>GET</code> 分别对应增、删、改、查四个操作。如果采用 <code>RESTful</code> 风格来开发 <code>Web API</code> 最好完全遵照 HTTP 请求方法和操作的对应关系，以便开发出更加语义化的接口。这里为了简单起见，Todo List 程序只使用了 <code>GET</code>、<code>POST</code> 两种请求方式，除了获取数据时采用 <code>GET</code> 请求，新增、修改、删除操作都采用 <code>POST</code> 请求方式。</p>
<ul>
<li>todo 首页新增编辑按钮</li>
</ul>
<p>编辑页面的 HTML 如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- todo_list/todo/templates/edit.html --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Todo List | Edit<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/css/style.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span>Edit<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"edit"</span> <span class="attr">action</span>=<span class="string">"/edit"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; todo.id &#125;&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"content"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; todo.content &#125;&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>将编辑页面的 CSS 代码追加到 <code>style.css</code> 文件中：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* todo_list/todo/static/css/style.css */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.new</span>, <span class="selector-class">.edit</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">600px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在模型层，给 <code>Todo</code> 模型类新增两个查询 todo 的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo_list/todo/models.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Todo 模型类</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_by</span><span class="params">(cls, limit=<span class="number">-1</span>, ensure_one=False, sort=False, reverse=False, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""查询 todo"""</span></span><br><span class="line">        result = []</span><br><span class="line">        todo_list = [todo.__dict__ <span class="keyword">for</span> todo <span class="keyword">in</span> cls.all(sort=sort, reverse=reverse)]</span><br><span class="line">        <span class="keyword">for</span> todo <span class="keyword">in</span> todo_list:</span><br><span class="line">            <span class="comment"># 根据关键字参数查询 todo</span></span><br><span class="line">            <span class="keyword">for</span> k, v <span class="keyword">in</span> kwargs.items():</span><br><span class="line">                <span class="keyword">if</span> todo.get(k) != v:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result.append(cls(**todo))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 查询给定条数的数据</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt; limit &lt; len(result):</span><br><span class="line">            result = result[:limit]</span><br><span class="line">        <span class="comment"># 查询结果集中的第一条数据</span></span><br><span class="line">        <span class="keyword">if</span> ensure_one:</span><br><span class="line">            result = result[<span class="number">0</span>] <span class="keyword">if</span> len(result) &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(cls, id)</span>:</span></span><br><span class="line">        <span class="string">"""通过 id 查询 todo"""</span></span><br><span class="line">        result = cls.find_by(id=id, ensure_one=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<p><code>find_by</code> 方法用来根据给定条件查询 todo，<code>get</code> 方法内部调用的还是 <code>find_by</code> 方法，只根据 <code>id</code> 来搜索，查询结果为单条数据，这两个方法均为类方法。</p>
<p>在控制器层，编写一个 <code>edit</code> 视图函数用来处理编辑 todo 的业务逻辑：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo_list/todo/controllers.py</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="string">"""编辑 todo 视图函数"""</span></span><br><span class="line">    <span class="comment"># 处理 POST 请求</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        form = request.form</span><br><span class="line">        print(<span class="string">f'form: <span class="subst">&#123;form&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">        id = int(form.get(<span class="string">'id'</span>, <span class="number">-1</span>))</span><br><span class="line">        content = form.get(<span class="string">'content'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> id != <span class="number">-1</span> <span class="keyword">and</span> content:</span><br><span class="line">            todo = Todo.get(id)</span><br><span class="line">            <span class="keyword">if</span> todo:</span><br><span class="line">                todo.content = content</span><br><span class="line">                todo.save()</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'/index'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 处理 GET 请求</span></span><br><span class="line">    args = request.args</span><br><span class="line">    print(<span class="string">f'args: <span class="subst">&#123;args&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    id = int(args.get(<span class="string">'id'</span>, <span class="number">-1</span>))</span><br><span class="line">    <span class="keyword">if</span> id == <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'/index'</span>)</span><br><span class="line"></span><br><span class="line">    todo = Todo.get(id)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> todo:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'/index'</span>)</span><br><span class="line"></span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">'todo'</span>: todo,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'edit.html'</span>, **context)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">routes = &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'/edit'</span>: (edit, [<span class="string">'GET'</span>, <span class="string">'POST'</span>]),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>edit</code> 视图函数跟之前编写的其他视图函数有些不同，它同时支持两种请求方法，<code>GET</code> 请求返回 HTML 页面，<code>POST</code> 请求用来处理修改 todo 的逻辑，并在修改完成后重定向到首页。</p>
<p>现在就可以使用 Todo List 程序的编辑功能来修改 todo 了：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="Todo_List_edit_todo_before.png" alt="编辑 todo" title="">
                </div>
                <div class="image-caption">编辑 todo</div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="Todo_List_edit_todo.png" alt="编辑 todo" title="">
                </div>
                <div class="image-caption">编辑 todo</div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="Todo_List_edit_todo_after.png" alt="编辑 todo" title="">
                </div>
                <div class="image-caption">编辑 todo</div>
            </figure>

<h3 id="删除-todo"><a href="#删除-todo" class="headerlink" title="删除 todo"></a>删除 todo</h3><p>删除 todo 的逻辑如下：</p>
<ol>
<li>点击首页中想要删除的 todo 右侧的删除按钮。</li>
<li>将这条 todo 的 <code>id</code> 通过 <code>POST</code> 请求传递到服务器端。</li>
<li>服务器端通过得到的 <code>id</code> 查询并删除对应的 todo。</li>
<li>重新返回到程序首页。</li>
</ol>
<p>首页 HTML 中添加删除按钮：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- todo_list/todo/templates/index.html --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Todo List<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入外部 CSS 样式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/css/style.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span>Todo List<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"new"</span> <span class="attr">action</span>=<span class="string">"/new"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"content"</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"save"</span>&gt;</span>新建<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        &#123;% for todo in todo_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; todo.content &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/edit?id=&#123;&#123; todo.id &#125;&#125;"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"delete"</span> <span class="attr">action</span>=<span class="string">"/delete"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; todo.id &#125;&#125;"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>将删除按钮的 CSS 代码追加到 <code>style.css</code> 文件中：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* todo_list/todo/static/css/style.css */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.delete</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在模型层，给 <code>Todo</code> 模型类新增一个 <code>delete</code> 实例方法用来从文件中删除 todo 对象：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo_list/todo/models.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Todo 模型类</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""删除 todo"""</span></span><br><span class="line">        todo_list = [todo.__dict__ <span class="keyword">for</span> todo <span class="keyword">in</span> self.all() <span class="keyword">if</span> todo.id != self.id]</span><br><span class="line">        self._save_db(todo_list)</span><br></pre></td></tr></table></figure>

<p>在控制器层，编写一个 <code>delete</code> 视图函数用来处理删除 todo 的业务逻辑：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo_list/todo/controllers.py</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="string">"""删除 todo 视图函数"""</span></span><br><span class="line">    form = request.form</span><br><span class="line">    print(<span class="string">f'form: <span class="subst">&#123;form&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    id = int(form.get(<span class="string">'id'</span>, <span class="number">-1</span>))</span><br><span class="line">    <span class="keyword">if</span> id != <span class="number">-1</span>:</span><br><span class="line">        todo = Todo.get(id)</span><br><span class="line">        <span class="keyword">if</span> todo:</span><br><span class="line">            todo.delete()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/index'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">routes = &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'/delete'</span>: (delete, [<span class="string">'POST'</span>]),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在就可以使用 Todo List 程序的删除功能来删除 todo 了：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="Todo_List_delete_todo.png" alt="删除 todo" title="">
                </div>
                <div class="image-caption">删除 todo</div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="Todo_List_delete_after_todo.png" alt="删除 todo" title="">
                </div>
                <div class="image-caption">删除 todo</div>
            </figure>

<p>至此，todo 的管理部分代码编写完成。</p>
<blockquote>
<p>本章源码：<a href="https://github.com/jianghushinian/todo-list/tree/master/chapter6" target="_blank" rel="noopener">chapter6</a></p>
</blockquote>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2022-12-24T13:16:45.407Z" itemprop="dateUpdated">2022-12-24 21:16:45</time>
</span><br>


        
        <a href="/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/" target="_blank" rel="external">http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/</a>
        
    </div>
    
    <footer>
        <a href="http://www.jianghushinian.cn">
            <img src="/img/avatar.png" alt="江湖十年">
            江湖十年
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/" rel="tag">Web</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/&title=《用 Python 撸一个 Web 服务器-第6章：完善 Todo List 应用》 — 江湖十年&pic=http://www.jianghushinian.cn/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/&title=《用 Python 撸一个 Web 服务器-第6章：完善 Todo List 应用》 — 江湖十年&source=这一章，我们来完成 todo 管理功能的剩余部分：新增、修改和删除功能。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《用 Python 撸一个 Web 服务器-第6章：完善 Todo List 应用》 — 江湖十年&url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/&via=http://www.jianghushinian.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC7%E7%AB%A0%EF%BC%9A%E9%87%8D%E6%9E%84%E2%80%94%E2%80%94%E6%9B%B4%E5%A5%BD%E7%9A%84%E7%BB%84%E7%BB%87%E4%BB%A3%E7%A0%81/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">用 Python 撸一个 Web 服务器-第7章：重构——更好的组织代码</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC5%E7%AB%A0%EF%BC%9A%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">用 Python 撸一个 Web 服务器-第5章：处理静态资源</h4>
      </a>
    </div>
  
</nav>



    








<section class="comments" id="comments">
    <div id="gitment_thread"></div>
    <link rel="stylesheet" href="//unpkg.com/gitment/style/default.css">
    <script src="//unpkg.com/gitment/dist/gitment.browser.js"></script>
    <script src="/js/md5.min.js"></script>
    <script>
        var gitment = new Gitment({
            id: md5(location.pathname),
            owner: 'jianghushinian',
            repo: 'jianghushinian.github.io',
            oauth: {
                client_id: '9d22aca5e6d2962ef86e',
                client_secret: '4a93d756cc14be84e76817cacbf8533fe424f1ae',
            },
        })
        gitment.render('comments')
    </script>
</section>













</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        <span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        <span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>江湖十年 &copy; 2019 - 2022</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/&title=《用 Python 撸一个 Web 服务器-第6章：完善 Todo List 应用》 — 江湖十年&pic=http://www.jianghushinian.cn/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/&title=《用 Python 撸一个 Web 服务器-第6章：完善 Todo List 应用》 — 江湖十年&source=这一章，我们来完成 todo 管理功能的剩余部分：新增、修改和删除功能。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《用 Python 撸一个 Web 服务器-第6章：完善 Todo List 应用》 — 江湖十年&url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/&via=http://www.jianghushinian.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://www.jianghushinian.cn/2020/07/17/%E7%94%A8-Python-%E6%92%B8%E4%B8%80%E4%B8%AA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E5%AE%8C%E5%96%84-Todo-List-%E5%BA%94%E7%94%A8/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
